/*! (c) 2019 pixiv Inc. - https://github.com/pixiv/three-vrm/blob/master/LICENSE */
var __three_vrm__=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=29)}([function(e,t){e.exports=THREE},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(34),t),i(n(35),t),i(n(36),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldQuaternionLite=t.getWorldScaleLite=t.getWorldPositionLite=t.linstep=t.saturate=void 0;var r=n(0);t.saturate=function(e){return Math.max(Math.min(e,1),0)},t.linstep=function(e,t,n){return e<=t?0:e>=n?1:(e-t)/(n-t)};var i=new r.Vector3,o=new r.Vector3,a=new r.Quaternion;t.getWorldPositionLite=function(e,t){return e.matrixWorld.decompose(t,a,o),t},t.getWorldScaleLite=function(e,t){return e.matrixWorld.decompose(i,a,t),t},t.getWorldQuaternionLite=function(e,t){return e.matrixWorld.decompose(i,t,o),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtHead=void 0;var r=n(0),i=n(2),o=Object.freeze(new r.Vector3(0,0,-1)),a=new r.Vector3,s=new r.Vector3,l=new r.Vector3,u=new r.Quaternion,c=function(){function e(t,n){this.autoUpdate=!0,this._euler=new r.Euler(0,0,0,e.EULER_ORDER),this.firstPerson=t,this.applyer=n}return e.prototype.getLookAtWorldDirection=function(e){var t=i.getWorldQuaternionLite(this.firstPerson.firstPersonBone,u);return e.copy(o).applyEuler(this._euler).applyQuaternion(t)},e.prototype.lookAt=function(e){this._calcEuler(this._euler,e),this.applyer&&this.applyer.lookAt(this._euler)},e.prototype.update=function(e){this.target&&this.autoUpdate&&(this.lookAt(this.target.getWorldPosition(a)),this.applyer&&this.applyer.lookAt(this._euler))},e.prototype._calcEuler=function(e,t){var n=this.firstPerson.getFirstPersonWorldPosition(s),r=l.copy(t).sub(n).normalize();return r.applyQuaternion(i.getWorldQuaternionLite(this.firstPerson.firstPersonBone,u).inverse()),e.x=Math.atan2(r.y,Math.sqrt(r.x*r.x+r.z*r.z)),e.y=Math.atan2(-r.x,-r.z),e},e.EULER_ORDER="YXZ",e}();t.VRMLookAtHead=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMDebug=t.VRM_GIZMO_RENDER_ORDER=void 0;var s=n(0),l=n(5),u=n(49);t.VRM_GIZMO_RENDER_ORDER=1e4;var c=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this,t)||this;return n.disableBoxHelper||r.scene.add(new s.BoxHelper(r.scene)),n.disableSkeletonHelper||r.scene.add(new s.SkeletonHelper(r.scene)),r}return i(t,e),t.from=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),o(this,void 0,Promise,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,new u.VRMImporterDebug(t).import(e,n)];case 1:return[2,r.sent()]}}))}))},t.prototype.update=function(t){e.prototype.update.call(this,t)},t}(l.VRM);t.VRMDebug=c},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRM=void 0;var o=n(32),a=n(6),s=function(){function e(e){this.scene=e.scene,this.humanoid=e.humanoid,this.blendShapeProxy=e.blendShapeProxy,this.firstPerson=e.firstPerson,this.lookAt=e.lookAt,this.materials=e.materials,this.springBoneManager=e.springBoneManager,this.meta=e.meta}return e.from=function(e,t){return void 0===t&&(t={}),r(this,void 0,Promise,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,new a.VRMImporter(t).import(e)];case 1:return[2,n.sent()]}}))}))},e.prototype.update=function(e){this.lookAt&&this.lookAt.update(e),this.blendShapeProxy&&this.blendShapeProxy.update(),this.springBoneManager&&this.springBoneManager.lateUpdate(e),this.materials&&this.materials.forEach((function(t){t.updateVRMMaterials&&t.updateVRMMaterials(e)}))},e.prototype.dispose=function(){var e=this.scene;e&&o.deepDispose(e)},e}();t.VRM=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMImporter=void 0;var o=n(11),a=n(14),s=n(16),l=n(7),u=n(22),c=n(9),d=n(5),h=function(){function e(e){void 0===e&&(e={}),this._blendShapeImporter=e.blendShapeImporter||new o.VRMBlendShapeImporter,this._lookAtImporter=e.lookAtImporter||new l.VRMLookAtImporter,this._humanoidImporter=e.humanoidImporter||new s.VRMHumanoidImporter,this._firstPersonImporter=e.firstPersonImporter||new a.VRMFirstPersonImporter,this._materialImporter=e.materialImporter||new u.VRMMaterialImporter,this._springBoneImporter=e.springBoneImporter||new c.VRMSpringBoneImporter}return e.prototype.import=function(e){return r(this,void 0,Promise,(function(){var t,n,r,o,a,s,l,u,c,h;return i(this,(function(i){switch(i.label){case 0:if(void 0===e.parser.json.extensions||void 0===e.parser.json.extensions.VRM)throw new Error("Could not find VRM extension on the GLTF");return t=e.parser.json.extensions.VRM,(n=e.scene).updateMatrixWorld(!1),n.traverse((function(e){e.isMesh&&(e.frustumCulled=!1)})),[4,this._materialImporter.convertGLTFMaterials(e)];case 1:return r=i.sent()||void 0,[4,this._humanoidImporter.import(e)];case 2:return(o=i.sent()||void 0)?[4,this._firstPersonImporter.import(e,o)]:[3,4];case 3:return s=i.sent()||void 0,[3,5];case 4:s=void 0,i.label=5;case 5:return a=s,[4,this._blendShapeImporter.import(e)];case 6:return l=i.sent()||void 0,a&&l&&o?[4,this._lookAtImporter.import(e,a,l,o)]:[3,8];case 7:return c=i.sent()||void 0,[3,9];case 8:c=void 0,i.label=9;case 9:return u=c,[4,this._springBoneImporter.import(e)];case 10:return h=i.sent()||void 0,[2,new d.VRM({scene:e.scene,meta:t.meta,materials:r,humanoid:o,firstPerson:a,blendShapeProxy:l,lookAt:u,springBoneManager:h})]}}))}))},e}();t.VRMImporter=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtImporter=void 0;var r=n(1),i=n(19),o=n(20),a=n(21),s=n(3),l=Math.PI/180,u=function(){function e(){}return e.prototype.import=function(e,t,n,r){var i=e.parser.json.extensions&&e.parser.json.extensions.VRM;if(!i)return null;var o=i.firstPerson;if(!o)return null;var a=this._importApplyer(o,n,r);return new s.VRMLookAtHead(t,a||void 0)},e.prototype._importApplyer=function(e,t,n){var i=e.lookAtHorizontalInner,s=e.lookAtHorizontalOuter,l=e.lookAtVerticalDown,u=e.lookAtVerticalUp;switch(e.lookAtTypeName){case r.VRMSchema.FirstPersonLookAtTypeName.Bone:return void 0===i||void 0===s||void 0===l||void 0===u?null:new a.VRMLookAtBoneApplyer(n,this._importCurveMapperBone(i),this._importCurveMapperBone(s),this._importCurveMapperBone(l),this._importCurveMapperBone(u));case r.VRMSchema.FirstPersonLookAtTypeName.BlendShape:return void 0===s||void 0===l||void 0===u?null:new o.VRMLookAtBlendShapeApplyer(t,this._importCurveMapperBlendShape(s),this._importCurveMapperBlendShape(l),this._importCurveMapperBlendShape(u));default:return null}},e.prototype._importCurveMapperBone=function(e){return new i.VRMCurveMapper("number"==typeof e.xRange?l*e.xRange:void 0,"number"==typeof e.yRange?l*e.yRange:void 0,e.curve)},e.prototype._importCurveMapperBlendShape=function(e){return new i.VRMCurveMapper("number"==typeof e.xRange?l*e.xRange:void 0,e.yRange,e.curve)},e}();t.VRMLookAtImporter=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtApplyer=void 0;var r=function(){};t.VRMLookAtApplyer=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSpringBoneImporter=void 0;var o=n(0),a=n(25),s=n(26),l=new o.Vector3,u=new o.MeshBasicMaterial({visible:!1}),c=function(){function e(){}return e.prototype.import=function(e){var t;return r(this,void 0,Promise,(function(){var n,r,o,a;return i(this,(function(i){switch(i.label){case 0:return(n=null===(t=e.parser.json.extensions)||void 0===t?void 0:t.VRM)&&(r=n.secondaryAnimation)?[4,this._importColliderMeshGroups(e,r)]:[2,null];case 1:return o=i.sent(),[4,this._importSpringBoneGroupList(e,r,o)];case 2:return a=i.sent(),[2,new s.VRMSpringBoneManager(o,a)]}}))}))},e.prototype._createSpringBone=function(e,t,n,r,i,o,s){return void 0===s&&(s=[]),new a.VRMSpringBone(e,t,n,r,i,o,s)},e.prototype._importSpringBoneGroupList=function(e,t,n){return r(this,void 0,Promise,(function(){var a,s,l=this;return i(this,(function(u){switch(u.label){case 0:return a=t.boneGroups||[],s=[],[4,Promise.all(a.map((function(t){return r(l,void 0,void 0,(function(){var a,l,u,c,d,h,p,f=this;return i(this,(function(m){switch(m.label){case 0:return void 0===t.stiffiness||void 0===t.gravityDir||void 0===t.gravityDir.x||void 0===t.gravityDir.y||void 0===t.gravityDir.z||void 0===t.gravityPower||void 0===t.dragForce||void 0===t.hitRadius||void 0===t.colliderGroups||void 0===t.bones?[2]:(a=t.stiffiness,l=new o.Vector3(t.gravityDir.x,t.gravityDir.y,-t.gravityDir.z),u=t.gravityPower,c=t.dragForce,d=t.hitRadius,h=[],t.colliderGroups.forEach((function(e){h.push.apply(h,n[e].colliders)})),p=[],[4,Promise.all(t.bones.map((function(t){return r(f,void 0,void 0,(function(){var n,r=this;return i(this,(function(i){switch(i.label){case 0:return[4,e.parser.getDependency("node",t)];case 1:return(n=i.sent())?(n.traverse((function(e){var t=r._createSpringBone(e,d,a,l,u,c,h);p.push(t)})),[2]):[2]}}))}))})))]);case 1:return m.sent(),s.push(p),[2]}}))}))})))];case 1:return u.sent(),[2,s]}}))}))},e.prototype._importColliderMeshGroups=function(e,t){return r(this,void 0,Promise,(function(){var n,o,a=this;return i(this,(function(s){return void 0===(n=t.colliderGroups)?[2,[]]:(o=[],n.forEach((function(t){return r(a,void 0,void 0,(function(){var n,r,a,s=this;return i(this,(function(i){switch(i.label){case 0:return void 0===t.node||void 0===t.colliders?[2]:[4,e.parser.getDependency("node",t.node)];case 1:return n=i.sent(),r=[],t.colliders.forEach((function(e){if(void 0!==e.offset&&void 0!==e.offset.x&&void 0!==e.offset.y&&void 0!==e.offset.z&&void 0!==e.radius){var t=l.set(e.offset.x,e.offset.y,-e.offset.z),i=s._createColliderMesh(e.radius,t);n.add(i),r.push(i)}})),a={node:t.node,colliders:r},o.push(a),[2]}}))}))})),[2,o])}))}))},e.prototype._createColliderMesh=function(e,t){var n=new o.Mesh(new o.SphereBufferGeometry(e,8,4),u);return n.position.copy(t),n.name="vrmColliderSphere",n.geometry.computeBoundingSphere(),n},e}();t.VRMSpringBoneImporter=c},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(25),t),i(n(53),t),i(n(9),t),i(n(26),t)},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(12),t),i(n(33),t),i(n(13),t)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMBlendShapeGroup=void 0;var o,a=n(0);!function(e){e[e.NUMBER=0]="NUMBER",e[e.VECTOR2=1]="VECTOR2",e[e.VECTOR3=2]="VECTOR3",e[e.VECTOR4=3]="VECTOR4",e[e.COLOR=4]="COLOR"}(o||(o={}));var s=new a.Vector2,l=new a.Vector3,u=new a.Vector4,c=new a.Color,d=function(e){function t(t){var n=e.call(this)||this;return n.weight=0,n.isBinary=!1,n._binds=[],n._materialValues=[],n.name="BlendShapeController_"+t,n.type="BlendShapeController",n.visible=!1,n}return i(t,e),t.prototype.addBind=function(e){var t=e.weight/100;this._binds.push({meshes:e.meshes,morphTargetIndex:e.morphTargetIndex,weight:t})},t.prototype.addMaterialValue=function(e){var t,n,r,i,s=e.material,l=e.propertyName,u=s[l];u&&((u=e.defaultValue||u).isVector2?(t=o.VECTOR2,n=u.clone(),i=(r=(new a.Vector2).fromArray(e.targetValue)).clone().sub(n)):u.isVector3?(t=o.VECTOR3,n=u.clone(),i=(r=(new a.Vector3).fromArray(e.targetValue)).clone().sub(n)):u.isVector4?(t=o.VECTOR4,n=u.clone(),i=(r=(new a.Vector4).fromArray([e.targetValue[2],e.targetValue[3],e.targetValue[0],e.targetValue[1]])).clone().sub(n)):u.isColor?(t=o.COLOR,n=u.clone(),i=(r=(new a.Color).fromArray(e.targetValue)).clone().sub(n)):(t=o.NUMBER,n=u,i=(r=e.targetValue[0])-n),this._materialValues.push({material:s,propertyName:l,defaultValue:n,targetValue:r,deltaValue:i,type:t}))},t.prototype.applyWeight=function(){var e=this.isBinary?this.weight<.5?0:1:this.weight;this._binds.forEach((function(t){t.meshes.forEach((function(n){n.morphTargetInfluences&&(n.morphTargetInfluences[t.morphTargetIndex]+=e*t.weight)}))})),this._materialValues.forEach((function(t){if(void 0!==t.material[t.propertyName]){if(t.type===o.NUMBER){var n=t.deltaValue;t.material[t.propertyName]+=n*e}else if(t.type===o.VECTOR2){n=t.deltaValue;t.material[t.propertyName].add(s.copy(n).multiplyScalar(e))}else if(t.type===o.VECTOR3){n=t.deltaValue;t.material[t.propertyName].add(l.copy(n).multiplyScalar(e))}else if(t.type===o.VECTOR4){n=t.deltaValue;t.material[t.propertyName].add(u.copy(n).multiplyScalar(e))}else if(t.type===o.COLOR){n=t.deltaValue;t.material[t.propertyName].add(c.copy(n).multiplyScalar(e))}"boolean"==typeof t.material.shouldApplyUniforms&&(t.material.shouldApplyUniforms=!0)}}))},t.prototype.clearAppliedWeight=function(){this._binds.forEach((function(e){e.meshes.forEach((function(t){t.morphTargetInfluences&&(t.morphTargetInfluences[e.morphTargetIndex]=0)}))})),this._materialValues.forEach((function(e){if(void 0!==e.material[e.propertyName]){if(e.type===o.NUMBER){var t=e.defaultValue;e.material[e.propertyName]=t}else if(e.type===o.VECTOR2){t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===o.VECTOR3){t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===o.VECTOR4){t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===o.COLOR){t=e.defaultValue;e.material[e.propertyName].copy(t)}"boolean"==typeof e.material.shouldApplyUniforms&&(e.material.shouldApplyUniforms=!0)}}))},t}(a.Object3D);t.VRMBlendShapeGroup=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMBlendShapeProxy=void 0;var r=n(2),i=function(){function e(){this._blendShapeGroups={},this._blendShapePresetMap={}}return Object.defineProperty(e.prototype,"expressions",{get:function(){return Object.keys(this._blendShapeGroups)},enumerable:!1,configurable:!0}),e.prototype.getBlendShapeGroup=function(e){var t=this._blendShapePresetMap[e],n=t?this._blendShapeGroups[t]:this._blendShapeGroups[e];if(n)return n;console.warn("no blend shape found by "+e)},e.prototype.registerBlendShapeGroup=function(e,t,n){this._blendShapeGroups[e]=n,t&&(this._blendShapePresetMap[t]=e)},e.prototype.getValue=function(e){var t=this.getBlendShapeGroup(e);return t&&t.weight||null},e.prototype.setValue=function(e,t){var n=this.getBlendShapeGroup(e);n&&(n.weight=r.saturate(t))},e.prototype.getBlendShapeTrackName=function(e){var t=this.getBlendShapeGroup(e);return t?t.name+".weight":null},e.prototype.update=function(){var e=this;Object.keys(this._blendShapeGroups).forEach((function(t){e._blendShapeGroups[t].clearAppliedWeight()})),Object.keys(this._blendShapeGroups).forEach((function(t){e._blendShapeGroups[t].applyWeight()}))},e}();t.VRMBlendShapeProxy=i},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(15),t),i(n(38),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMFirstPerson=t.VRMRendererFirstPersonFlags=void 0;var r,i=n(0),o=n(2),a=Object.freeze(new i.Vector3(0,0,-1)),s=new i.Quaternion;!function(e){e[e.Auto=0]="Auto",e[e.Both=1]="Both",e[e.ThirdPersonOnly=2]="ThirdPersonOnly",e[e.FirstPersonOnly=3]="FirstPersonOnly"}(r||(r={}));var l=function(){function e(t,n){this.firstPersonFlag=e._parseFirstPersonFlag(t),this.mesh=n}return e._parseFirstPersonFlag=function(e){switch(e){case"Both":return r.Both;case"ThirdPersonOnly":return r.ThirdPersonOnly;case"FirstPersonOnly":return r.FirstPersonOnly;default:return r.Auto}},e}();t.VRMRendererFirstPersonFlags=l;var u=function(){function e(t,n,r){this._meshAnnotations=[],this._firstPersonOnlyLayer=e._DEFAULT_FIRSTPERSON_ONLY_LAYER,this._thirdPersonOnlyLayer=e._DEFAULT_THIRDPERSON_ONLY_LAYER,this._initialized=!1,this._firstPersonBone=t,this._firstPersonBoneOffset=n,this._meshAnnotations=r}return Object.defineProperty(e.prototype,"firstPersonBone",{get:function(){return this._firstPersonBone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"meshAnnotations",{get:function(){return this._meshAnnotations},enumerable:!1,configurable:!0}),e.prototype.getFirstPersonWorldDirection=function(e){return e.copy(a).applyQuaternion(o.getWorldQuaternionLite(this._firstPersonBone,s))},Object.defineProperty(e.prototype,"firstPersonOnlyLayer",{get:function(){return this._firstPersonOnlyLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thirdPersonOnlyLayer",{get:function(){return this._thirdPersonOnlyLayer},enumerable:!1,configurable:!0}),e.prototype.getFirstPersonBoneOffset=function(e){return e.copy(this._firstPersonBoneOffset)},e.prototype.getFirstPersonWorldPosition=function(e){var t=this._firstPersonBoneOffset,n=new i.Vector4(t.x,t.y,t.z,1);return n.applyMatrix4(this._firstPersonBone.matrixWorld),e.set(n.x,n.y,n.z)},e.prototype.setup=function(t){var n=this,i=void 0===t?{}:t,o=i.firstPersonOnlyLayer,a=void 0===o?e._DEFAULT_FIRSTPERSON_ONLY_LAYER:o,s=i.thirdPersonOnlyLayer,l=void 0===s?e._DEFAULT_THIRDPERSON_ONLY_LAYER:s;this._initialized||(this._initialized=!0,this._firstPersonOnlyLayer=a,this._thirdPersonOnlyLayer=l,this._meshAnnotations.forEach((function(e){e.firstPersonFlag===r.FirstPersonOnly?(e.mesh.layers.set(n._firstPersonOnlyLayer),e.mesh.traverse((function(e){return e.layers.set(n._firstPersonOnlyLayer)}))):e.firstPersonFlag===r.ThirdPersonOnly?(e.mesh.layers.set(n._thirdPersonOnlyLayer),e.mesh.traverse((function(e){return e.layers.set(n._thirdPersonOnlyLayer)}))):e.firstPersonFlag===r.Auto&&n._createHeadlessModel(e.mesh)})))},e.prototype._excludeTriangles=function(e,t,n,r){var i=0;if(null!=t&&t.length>0)for(var o=0;o<e.length;o+=3){var a=e[o],s=e[o+1],l=e[o+2],u=t[a],c=n[a];if(!(u[0]>0&&r.includes(c[0]))&&!(u[1]>0&&r.includes(c[1])||u[2]>0&&r.includes(c[2])||u[3]>0&&r.includes(c[3]))){var d=t[s],h=n[s];if(!(d[0]>0&&r.includes(h[0])||d[1]>0&&r.includes(h[1])||d[2]>0&&r.includes(h[2])||d[3]>0&&r.includes(h[3]))){var p=t[l],f=n[l];p[0]>0&&r.includes(f[0])||p[1]>0&&r.includes(f[1])||p[2]>0&&r.includes(f[2])||p[3]>0&&r.includes(f[3])||(e[i++]=a,e[i++]=s,e[i++]=l)}}}return i},e.prototype._createErasedMesh=function(e,t){var n=new i.SkinnedMesh(e.geometry.clone(),e.material);n.name=e.name+"(erase)",n.frustumCulled=e.frustumCulled,n.layers.set(this._firstPersonOnlyLayer);for(var r=n.geometry,o=r.getAttribute("skinIndex").array,a=[],s=0;s<o.length;s+=4)a.push([o[s],o[s+1],o[s+2],o[s+3]]);var l=r.getAttribute("skinWeight").array,u=[];for(s=0;s<l.length;s+=4)u.push([l[s],l[s+1],l[s+2],l[s+3]]);var c=r.getIndex();if(!c)throw new Error("The geometry doesn't have an index buffer");var d=Array.from(c.array),h=this._excludeTriangles(d,u,a,t),p=[];for(s=0;s<h;s++)p[s]=d[s];return r.setIndex(p),e.onBeforeRender&&(n.onBeforeRender=e.onBeforeRender),n.bind(new i.Skeleton(e.skeleton.bones,e.skeleton.boneInverses),new i.Matrix4),n},e.prototype._createHeadlessModelForSkinnedMesh=function(e,t){var n=this,r=[];if(t.skeleton.bones.forEach((function(e,t){n._isEraseTarget(e)&&r.push(t)})),!r.length)return t.layers.enable(this._thirdPersonOnlyLayer),void t.layers.enable(this._firstPersonOnlyLayer);t.layers.set(this._thirdPersonOnlyLayer);var i=this._createErasedMesh(t,r);e.add(i)},e.prototype._createHeadlessModel=function(e){var t=this;if("Group"===e.type)if(e.layers.set(this._thirdPersonOnlyLayer),this._isEraseTarget(e))e.traverse((function(e){return e.layers.set(t._thirdPersonOnlyLayer)}));else{var n=new i.Group;n.name="_headless_"+e.name,n.layers.set(this._firstPersonOnlyLayer),e.parent.add(n),e.children.filter((function(e){return"SkinnedMesh"===e.type})).forEach((function(e){t._createHeadlessModelForSkinnedMesh(n,e)}))}else"SkinnedMesh"===e.type?this._createHeadlessModelForSkinnedMesh(e.parent,e):this._isEraseTarget(e)&&(e.layers.set(this._thirdPersonOnlyLayer),e.traverse((function(e){return e.layers.set(t._thirdPersonOnlyLayer)})))},e.prototype._isEraseTarget=function(e){return e.name===this._firstPersonBone.name||!!e.parent&&this._isEraseTarget(e.parent)},e._DEFAULT_FIRSTPERSON_ONLY_LAYER=9,e._DEFAULT_THIRDPERSON_ONLY_LAYER=10,e}();t.VRMFirstPerson=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMHumanoidImporter=void 0;var o=n(0),a=n(17),s=n(18),l=function(){function e(){}return e.prototype.import=function(e){return r(this,void 0,Promise,(function(){var t,n,l,u,c=this;return i(this,(function(d){switch(d.label){case 0:return(t=e.parser.json.extensions&&e.parser.json.extensions.VRM)&&(n=t.humanoid)?(l=[],n.humanBones?[4,Promise.all(n.humanBones.map((function(t){return r(c,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return t.bone&&t.node?[4,e.parser.getDependency("node",t.node)]:[2];case 1:return n=r.sent(),l.push({name:t.bone,bone:new a.VRMHumanBone(n,{axisLength:t.axisLength,center:t.center&&new o.Vector3(t.center.x,t.center.y,t.center.z),max:t.max&&new o.Vector3(t.max.x,t.max.y,t.max.z),min:t.min&&new o.Vector3(t.min.x,t.min.y,t.min.z),useDefaultValues:t.useDefaultValues})}),[2]}}))}))})))]:[3,2]):[2,null];case 1:d.sent(),d.label=2;case 2:return u={armStretch:n.armStretch,legStretch:n.legStretch,upperArmTwist:n.upperArmTwist,lowerArmTwist:n.lowerArmTwist,upperLegTwist:n.upperLegTwist,lowerLegTwist:n.lowerLegTwist,feetSpacing:n.feetSpacing,hasTranslationDoF:n.hasTranslationDoF},[2,new s.VRMHumanoid(l,u)]}}))}))},e}();t.VRMHumanoidImporter=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMHumanBone=void 0;var r=function(e,t){this.node=e,this.humanLimit=t};t.VRMHumanBone=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMHumanoid=void 0;var r=n(1),i=function(){function e(e,t){this.humanBones=this._createHumanBones(e),this.humanDescription=t,this.restPose=this.getPose()}return e.prototype.getPose=function(){var e=this,t={};return Object.keys(this.humanBones).forEach((function(n){var r=e.getBoneNode(n);r&&(t[n]||(t[n]={position:r.position.toArray(),rotation:r.quaternion.toArray()}))}),{}),t},e.prototype.setPose=function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],i=t.getBoneNode(n);if(i){var o=t.restPose[n];o&&(r.position&&i.position.set(o.position[0]+r.position[0],o.position[1]+r.position[1],o.position[2]+r.position[2]),r.rotation&&i.quaternion.fromArray(r.rotation))}}))},e.prototype.getBone=function(e){return this.humanBones[e][0]||void 0},e.prototype.getBones=function(e){return this.humanBones[e]},e.prototype.getBoneNode=function(e){return this.humanBones[e][0]&&this.humanBones[e][0].node||null},e.prototype.getBoneNodes=function(e){return this.humanBones[e].map((function(e){return e.node}))},e.prototype._createHumanBones=function(e){var t=Object.values(r.VRMSchema.HumanoidBoneName).reduce((function(e,t){return e[t]=[],e}),{});return e.forEach((function(e){t[e.name].push(e.bone)})),t},e}();t.VRMHumanoid=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMCurveMapper=void 0;var r=function(){function e(e,t,n){this.curve=[0,0,0,1,1,1,1,0],this.curveXRangeDegree=90,this.curveYRangeDegree=10,void 0!==e&&(this.curveXRangeDegree=e),void 0!==t&&(this.curveYRangeDegree=t),void 0!==n&&(this.curve=n)}return e.prototype.map=function(e){var t=Math.min(Math.max(e,0),this.curveXRangeDegree)/this.curveXRangeDegree;return this.curveYRangeDegree*function(e,t){if(e.length<8)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be 8 at least)");if(e.length%4!=0)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be multiples of 4");var n;for(n=0;;n++){if(e.length<=4*n)return e[4*n-3];if(t<=e[4*n])break}var r=n-1;if(r<0)return e[4*r+5];var i=e[4*r],o=(t-i)/(e[4*n]-i);return function(e,t,n,r,i){var o=i*i*i,a=i*i;return e+(t-e)*(-2*o+3*a)+n*(o-2*a+i)+r*(o-a)}(e[4*r+1],e[4*n+1],e[4*r+3],e[4*n+2],o)}(this.curve,t)},e}();t.VRMCurveMapper=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtBlendShapeApplyer=void 0;var o=n(1),a=function(e){function t(t,n,r,i){var a=e.call(this)||this;return a.type=o.VRMSchema.FirstPersonLookAtTypeName.BlendShape,a._curveHorizontal=n,a._curveVerticalDown=r,a._curveVerticalUp=i,a._blendShapeProxy=t,a}return i(t,e),t.prototype.name=function(){return o.VRMSchema.FirstPersonLookAtTypeName.BlendShape},t.prototype.lookAt=function(e){var t=e.x,n=e.y;t<0?(this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookup,0),this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookdown,this._curveVerticalDown.map(-t))):(this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookdown,0),this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookup,this._curveVerticalUp.map(t))),n<0?(this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookleft,0),this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookright,this._curveHorizontal.map(-n))):(this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookright,0),this._blendShapeProxy.setValue(o.VRMSchema.BlendShapePresetName.Lookleft,this._curveHorizontal.map(n)))},t}(n(8).VRMLookAtApplyer);t.VRMLookAtBlendShapeApplyer=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtBoneApplyer=void 0;var o=n(0),a=n(1),s=n(8),l=n(3),u=new o.Euler(0,0,0,l.VRMLookAtHead.EULER_ORDER),c=function(e){function t(t,n,r,i,o){var s=e.call(this)||this;return s.type=a.VRMSchema.FirstPersonLookAtTypeName.Bone,s._curveHorizontalInner=n,s._curveHorizontalOuter=r,s._curveVerticalDown=i,s._curveVerticalUp=o,s._leftEye=t.getBoneNode(a.VRMSchema.HumanoidBoneName.LeftEye),s._rightEye=t.getBoneNode(a.VRMSchema.HumanoidBoneName.RightEye),s}return i(t,e),t.prototype.lookAt=function(e){var t=e.x,n=e.y;this._leftEye&&(u.x=t<0?-this._curveVerticalDown.map(-t):this._curveVerticalUp.map(t),u.y=n<0?-this._curveHorizontalInner.map(-n):this._curveHorizontalOuter.map(n),this._leftEye.quaternion.setFromEuler(u)),this._rightEye&&(u.x=t<0?-this._curveVerticalDown.map(-t):this._curveVerticalUp.map(t),u.y=n<0?-this._curveHorizontalOuter.map(-n):this._curveHorizontalInner.map(n),this._rightEye.quaternion.setFromEuler(u))},t}(s.VRMLookAtApplyer);t.VRMLookAtBoneApplyer=c},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(23),t),i(n(42),t),i(n(24),t)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.MToonMaterial=t.MToonMaterialRenderMode=t.MToonMaterialOutlineWidthMode=t.MToonMaterialOutlineColorMode=t.MToonMaterialDebugMode=t.MToonMaterialCullMode=void 0;var o,a,s,l,u,c=n(0),d=n(39),h=n(40),p=n(41),f=2*Math.PI;!function(e){e[e.Off=0]="Off",e[e.Front=1]="Front",e[e.Back=2]="Back"}(o=t.MToonMaterialCullMode||(t.MToonMaterialCullMode={})),function(e){e[e.None=0]="None",e[e.Normal=1]="Normal",e[e.LitShadeRate=2]="LitShadeRate",e[e.UV=3]="UV"}(a=t.MToonMaterialDebugMode||(t.MToonMaterialDebugMode={})),function(e){e[e.FixedColor=0]="FixedColor",e[e.MixedLighting=1]="MixedLighting"}(s=t.MToonMaterialOutlineColorMode||(t.MToonMaterialOutlineColorMode={})),function(e){e[e.None=0]="None",e[e.WorldCoordinates=1]="WorldCoordinates",e[e.ScreenCoordinates=2]="ScreenCoordinates"}(l=t.MToonMaterialOutlineWidthMode||(t.MToonMaterialOutlineWidthMode={})),function(e){e[e.Opaque=0]="Opaque",e[e.Cutout=1]="Cutout",e[e.Transparent=2]="Transparent",e[e.TransparentWithZWrite=3]="TransparentWithZWrite"}(u=t.MToonMaterialRenderMode||(t.MToonMaterialRenderMode={}));var m=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.isMToonMaterial=!0,n.cutoff=.5,n.color=new c.Vector4(1,1,1,1),n.shadeColor=new c.Vector4(.97,.81,.86,1),n.map=null,n.mainTex_ST=new c.Vector4(0,0,1,1),n.shadeTexture=null,n.normalMap=null,n.normalMapType=c.TangentSpaceNormalMap,n.normalScale=new c.Vector2(1,1),n.receiveShadowRate=1,n.receiveShadowTexture=null,n.shadingGradeRate=1,n.shadingGradeTexture=null,n.shadeShift=0,n.shadeToony=.9,n.lightColorAttenuation=0,n.indirectLightIntensity=.1,n.rimTexture=null,n.rimColor=new c.Vector4(0,0,0,1),n.rimLightingMix=0,n.rimFresnelPower=1,n.rimLift=0,n.sphereAdd=null,n.emissionColor=new c.Vector4(0,0,0,1),n.emissiveMap=null,n.outlineWidthTexture=null,n.outlineWidth=.5,n.outlineScaledMaxDistance=1,n.outlineColor=new c.Vector4(0,0,0,1),n.outlineLightingMix=1,n.uvAnimMaskTexture=null,n.uvAnimScrollX=0,n.uvAnimScrollY=0,n.uvAnimRotation=0,n.shouldApplyUniforms=!0,n._debugMode=a.None,n._blendMode=u.Opaque,n._outlineWidthMode=l.None,n._outlineColorMode=s.FixedColor,n._cullMode=o.Back,n._outlineCullMode=o.Front,n._isOutline=!1,n._uvAnimOffsetX=0,n._uvAnimOffsetY=0,n._uvAnimPhase=0,n.encoding=t.encoding||c.LinearEncoding,n.encoding!==c.LinearEncoding&&n.encoding!==c.sRGBEncoding&&console.warn("The specified color encoding does not work properly with MToonMaterial. You might want to use THREE.sRGBEncoding instead."),["mToonVersion","shadeTexture_ST","bumpMap_ST","receiveShadowTexture_ST","shadingGradeTexture_ST","rimTexture_ST","sphereAdd_ST","emissionMap_ST","outlineWidthTexture_ST","uvAnimMaskTexture_ST","srcBlend","dstBlend"].forEach((function(e){void 0!==t[e]&&delete t[e]})),t.fog=!0,t.lights=!0,t.clipping=!0,t.skinning=t.skinning||!1,t.morphTargets=t.morphTargets||!1,t.morphNormals=t.morphNormals||!1,t.uniforms=c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.normalmap,c.UniformsLib.emissivemap,c.UniformsLib.fog,c.UniformsLib.lights,{cutoff:{value:.5},color:{value:new c.Color(1,1,1)},colorAlpha:{value:1},shadeColor:{value:new c.Color(.97,.81,.86)},mainTex_ST:{value:new c.Vector4(0,0,1,1)},shadeTexture:{value:null},receiveShadowRate:{value:1},receiveShadowTexture:{value:null},shadingGradeRate:{value:1},shadingGradeTexture:{value:null},shadeShift:{value:0},shadeToony:{value:.9},lightColorAttenuation:{value:0},indirectLightIntensity:{value:.1},rimTexture:{value:null},rimColor:{value:new c.Color(0,0,0)},rimLightingMix:{value:0},rimFresnelPower:{value:1},rimLift:{value:0},sphereAdd:{value:null},emissionColor:{value:new c.Color(0,0,0)},outlineWidthTexture:{value:null},outlineWidth:{value:.5},outlineScaledMaxDistance:{value:1},outlineColor:{value:new c.Color(0,0,0)},outlineLightingMix:{value:1},uvAnimMaskTexture:{value:null},uvAnimOffsetX:{value:0},uvAnimOffsetY:{value:0},uvAnimTheta:{value:0}}]),n.setValues(t),n._updateShaderCode(),n._applyUniforms(),n}return i(t,e),Object.defineProperty(t.prototype,"mainTex",{get:function(){return this.map},set:function(e){this.map=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bumpMap",{get:function(){return this.normalMap},set:function(e){this.normalMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bumpScale",{get:function(){return this.normalScale.x},set:function(e){this.normalScale.set(e,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emissionMap",{get:function(){return this.emissiveMap},set:function(e){this.emissiveMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this._blendMode=e,this.depthWrite=this._blendMode!==u.Transparent,this.transparent=this._blendMode===u.Transparent||this._blendMode===u.TransparentWithZWrite,this._updateShaderCode()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debugMode",{get:function(){return this._debugMode},set:function(e){this._debugMode=e,this._updateShaderCode()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidthMode",{get:function(){return this._outlineWidthMode},set:function(e){this._outlineWidthMode=e,this._updateShaderCode()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineColorMode",{get:function(){return this._outlineColorMode},set:function(e){this._outlineColorMode=e,this._updateShaderCode()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cullMode",{get:function(){return this._cullMode},set:function(e){this._cullMode=e,this._updateCullFace()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineCullMode",{get:function(){return this._outlineCullMode},set:function(e){this._outlineCullMode=e,this._updateCullFace()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zWrite",{get:function(){return this.depthWrite?1:0},set:function(e){this.depthWrite=.5<=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOutline",{get:function(){return this._isOutline},set:function(e){this._isOutline=e,this._updateShaderCode(),this._updateCullFace()},enumerable:!1,configurable:!0}),t.prototype.updateVRMMaterials=function(e){this._uvAnimOffsetX=this._uvAnimOffsetX+e*this.uvAnimScrollX,this._uvAnimOffsetY=this._uvAnimOffsetY+e*this.uvAnimScrollY,this._uvAnimPhase=this._uvAnimPhase+e*this.uvAnimRotation,this._applyUniforms()},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.cutoff=t.cutoff,this.color.copy(t.color),this.shadeColor.copy(t.shadeColor),this.map=t.map,this.mainTex_ST.copy(t.mainTex_ST),this.shadeTexture=t.shadeTexture,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(this.normalScale),this.receiveShadowRate=t.receiveShadowRate,this.receiveShadowTexture=t.receiveShadowTexture,this.shadingGradeRate=t.shadingGradeRate,this.shadingGradeTexture=t.shadingGradeTexture,this.shadeShift=t.shadeShift,this.shadeToony=t.shadeToony,this.lightColorAttenuation=t.lightColorAttenuation,this.indirectLightIntensity=t.indirectLightIntensity,this.rimTexture=t.rimTexture,this.rimColor.copy(t.rimColor),this.rimLightingMix=t.rimLightingMix,this.rimFresnelPower=t.rimFresnelPower,this.rimLift=t.rimLift,this.sphereAdd=t.sphereAdd,this.emissionColor.copy(t.emissionColor),this.emissiveMap=t.emissiveMap,this.outlineWidthTexture=t.outlineWidthTexture,this.outlineWidth=t.outlineWidth,this.outlineScaledMaxDistance=t.outlineScaledMaxDistance,this.outlineColor.copy(t.outlineColor),this.outlineLightingMix=t.outlineLightingMix,this.uvAnimMaskTexture=t.uvAnimMaskTexture,this.uvAnimScrollX=t.uvAnimScrollX,this.uvAnimScrollY=t.uvAnimScrollY,this.uvAnimRotation=t.uvAnimRotation,this.debugMode=t.debugMode,this.blendMode=t.blendMode,this.outlineWidthMode=t.outlineWidthMode,this.outlineColorMode=t.outlineColorMode,this.cullMode=t.cullMode,this.outlineCullMode=t.outlineCullMode,this.isOutline=t.isOutline,this},t.prototype._applyUniforms=function(){this.uniforms.uvAnimOffsetX.value=this._uvAnimOffsetX,this.uniforms.uvAnimOffsetY.value=this._uvAnimOffsetY,this.uniforms.uvAnimTheta.value=f*this._uvAnimPhase,this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.color.value.setRGB(this.color.x,this.color.y,this.color.z),this.uniforms.colorAlpha.value=this.color.w,this.uniforms.shadeColor.value.setRGB(this.shadeColor.x,this.shadeColor.y,this.shadeColor.z),this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST),this.uniforms.shadeTexture.value=this.shadeTexture,this.uniforms.normalMap.value=this.normalMap,this.uniforms.normalScale.value.copy(this.normalScale),this.uniforms.receiveShadowRate.value=this.receiveShadowRate,this.uniforms.receiveShadowTexture.value=this.receiveShadowTexture,this.uniforms.shadingGradeRate.value=this.shadingGradeRate,this.uniforms.shadingGradeTexture.value=this.shadingGradeTexture,this.uniforms.shadeShift.value=this.shadeShift,this.uniforms.shadeToony.value=this.shadeToony,this.uniforms.lightColorAttenuation.value=this.lightColorAttenuation,this.uniforms.indirectLightIntensity.value=this.indirectLightIntensity,this.uniforms.rimTexture.value=this.rimTexture,this.uniforms.rimColor.value.setRGB(this.rimColor.x,this.rimColor.y,this.rimColor.z),this.uniforms.rimLightingMix.value=this.rimLightingMix,this.uniforms.rimFresnelPower.value=this.rimFresnelPower,this.uniforms.rimLift.value=this.rimLift,this.uniforms.sphereAdd.value=this.sphereAdd,this.uniforms.emissionColor.value.setRGB(this.emissionColor.x,this.emissionColor.y,this.emissionColor.z),this.uniforms.emissiveMap.value=this.emissiveMap,this.uniforms.outlineWidthTexture.value=this.outlineWidthTexture,this.uniforms.outlineWidth.value=this.outlineWidth,this.uniforms.outlineScaledMaxDistance.value=this.outlineScaledMaxDistance,this.uniforms.outlineColor.value.setRGB(this.outlineColor.x,this.outlineColor.y,this.outlineColor.z),this.uniforms.outlineLightingMix.value=this.outlineLightingMix,this.uniforms.uvAnimMaskTexture.value=this.uvAnimMaskTexture,this.encoding===c.sRGBEncoding&&(this.uniforms.color.value.convertSRGBToLinear(),this.uniforms.shadeColor.value.convertSRGBToLinear(),this.uniforms.rimColor.value.convertSRGBToLinear(),this.uniforms.emissionColor.value.convertSRGBToLinear(),this.uniforms.outlineColor.value.convertSRGBToLinear()),this._updateCullFace())},t.prototype._updateShaderCode=function(){this.defines={OUTLINE:this._isOutline,BLENDMODE_OPAQUE:this._blendMode===u.Opaque,BLENDMODE_CUTOUT:this._blendMode===u.Cutout,BLENDMODE_TRANSPARENT:this._blendMode===u.Transparent||this._blendMode===u.TransparentWithZWrite,USE_SHADETEXTURE:null!==this.shadeTexture,USE_RECEIVESHADOWTEXTURE:null!==this.receiveShadowTexture,USE_SHADINGGRADETEXTURE:null!==this.shadingGradeTexture,USE_RIMTEXTURE:null!==this.rimTexture,USE_SPHEREADD:null!==this.sphereAdd,USE_OUTLINEWIDTHTEXTURE:null!==this.outlineWidthTexture,USE_UVANIMMASKTEXTURE:null!==this.uvAnimMaskTexture,DEBUG_NORMAL:this._debugMode===a.Normal,DEBUG_LITSHADERATE:this._debugMode===a.LitShadeRate,DEBUG_UV:this._debugMode===a.UV,OUTLINE_WIDTH_WORLD:this._outlineWidthMode===l.WorldCoordinates,OUTLINE_WIDTH_SCREEN:this._outlineWidthMode===l.ScreenCoordinates,OUTLINE_COLOR_FIXED:this._outlineColorMode===s.FixedColor,OUTLINE_COLOR_MIXED:this._outlineColorMode===s.MixedLighting};var e=(null!==this.shadeTexture?d.getTexelDecodingFunction("shadeTextureTexelToLinear",this.shadeTexture.encoding)+"\n":"")+(null!==this.sphereAdd?d.getTexelDecodingFunction("sphereAddTexelToLinear",this.sphereAdd.encoding)+"\n":"")+(null!==this.rimTexture?d.getTexelDecodingFunction("rimTextureTexelToLinear",this.rimTexture.encoding)+"\n":"");this.vertexShader=h.default,this.fragmentShader=e+p.default,this.needsUpdate=!0},t.prototype._updateCullFace=function(){this.isOutline?this.outlineCullMode===o.Off?this.side=c.DoubleSide:this.outlineCullMode===o.Front?this.side=c.BackSide:this.outlineCullMode===o.Back&&(this.side=c.FrontSide):this.cullMode===o.Off?this.side=c.DoubleSide:this.cullMode===o.Front?this.side=c.BackSide:this.cullMode===o.Back&&(this.side=c.FrontSide)},t}(c.ShaderMaterial);t.MToonMaterial=m},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMUnlitMaterial=t.VRMUnlitMaterialRenderType=void 0;var o,a=n(0),s=n(43),l=n(44);!function(e){e[e.Opaque=0]="Opaque",e[e.Cutout=1]="Cutout",e[e.Transparent=2]="Transparent",e[e.TransparentWithZWrite=3]="TransparentWithZWrite"}(o=t.VRMUnlitMaterialRenderType||(t.VRMUnlitMaterialRenderType={}));var u=function(e){function t(t){var n=e.call(this)||this;return n.isVRMUnlitMaterial=!0,n.cutoff=.5,n.map=null,n.mainTex_ST=new a.Vector4(0,0,1,1),n._renderType=o.Opaque,n.shouldApplyUniforms=!0,void 0===t&&(t={}),t.fog=!0,t.clipping=!0,t.skinning=t.skinning||!1,t.morphTargets=t.morphTargets||!1,t.morphNormals=t.morphNormals||!1,t.uniforms=a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,{cutoff:{value:.5},mainTex_ST:{value:new a.Vector4(0,0,1,1)}}]),n.setValues(t),n._updateShaderCode(),n._applyUniforms(),n}return i(t,e),Object.defineProperty(t.prototype,"mainTex",{get:function(){return this.map},set:function(e){this.map=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderType",{get:function(){return this._renderType},set:function(e){this._renderType=e,this.depthWrite=this._renderType!==o.Transparent,this.transparent=this._renderType===o.Transparent||this._renderType===o.TransparentWithZWrite,this._updateShaderCode()},enumerable:!1,configurable:!0}),t.prototype.updateVRMMaterials=function(e){this._applyUniforms()},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.cutoff=t.cutoff,this.map=t.map,this.mainTex_ST.copy(t.mainTex_ST),this.renderType=t.renderType,this},t.prototype._applyUniforms=function(){this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST))},t.prototype._updateShaderCode=function(){this.defines={RENDERTYPE_OPAQUE:this._renderType===o.Opaque,RENDERTYPE_CUTOUT:this._renderType===o.Cutout,RENDERTYPE_TRANSPARENT:this._renderType===o.Transparent||this._renderType===o.TransparentWithZWrite},this.vertexShader=s.default,this.fragmentShader=l.default,this.needsUpdate=!0},t}(a.ShaderMaterial);t.VRMUnlitMaterial=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSpringBone=void 0;var r=n(0),i=n(2),o=Object.freeze(new r.Matrix4),a=Object.freeze(new r.Quaternion),s=new r.Vector3,l=new r.Vector3,u=new r.Vector3,c=new r.Quaternion,d=new r.Matrix4,h=new r.Matrix4,p=function(){function e(e,t,n,i,o,a,l){var u=this;void 0===l&&(l=[]),this.bone=e,this.bone.matrixAutoUpdate=!1,this.radius=t,this.stiffnessForce=n,this.gravityDir=(new r.Vector3).copy(i),this.gravityPower=o,this.dragForce=a,this.colliders=l,this._worldPosition=(new r.Vector3).setFromMatrixPosition(this.bone.matrixWorld),this._parentWorldRotation=new r.Quaternion,this._initialLocalMatrix=this.bone.matrix.clone(),this._initialLocalRotation=this.bone.quaternion.clone(),this._initialLocalChildPosition=0===u.bone.children.length?u.bone.position.clone().normalize().multiplyScalar(.07):u.bone.children[0].position.clone(),this._currentTail=this.bone.localToWorld(this._initialLocalChildPosition.clone()),this._prevTail=this._currentTail.clone(),this._nextTail=this._currentTail.clone(),this._boneAxis=this._initialLocalChildPosition.clone().normalize(),this._worldBoneLength=this.bone.localToWorld(s.copy(this._initialLocalChildPosition)).sub(this._worldPosition).length()}return e.prototype.reset=function(){this.bone.quaternion.copy(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix),this._worldPosition.setFromMatrixPosition(this.bone.matrixWorld),this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)),this._prevTail.copy(this._currentTail),this._nextTail.copy(this._currentTail)},e.prototype.update=function(e){if(!(e<=0)){this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix),this.bone.parent?i.getWorldQuaternionLite(this.bone.parent,this._parentWorldRotation):this._parentWorldRotation.copy(a),this._worldPosition.setFromMatrixPosition(this.bone.matrixWorld);var t=this.stiffnessForce*e,n=l.copy(this.gravityDir).multiplyScalar(this.gravityPower*e);this._nextTail.copy(this._currentTail).add(s.copy(this._currentTail).sub(this._prevTail).multiplyScalar(1-this.dragForce)).add(s.copy(this._boneAxis).applyMatrix4(this._initialLocalMatrix).applyMatrix4(this._getParentMatrixWorld()).sub(this._worldPosition).normalize().multiplyScalar(t)).add(n),this._nextTail.sub(this._worldPosition).normalize().multiplyScalar(this._worldBoneLength).add(this._worldPosition),this._collision(this._nextTail),this._prevTail.copy(this._currentTail),this._currentTail.copy(this._nextTail);var r=d.getInverse(h.copy(this._getParentMatrixWorld()).multiply(this._initialLocalMatrix)),o=c.setFromUnitVectors(this._boneAxis,s.copy(this._nextTail).applyMatrix4(r).normalize());this.bone.quaternion.copy(this._initialLocalRotation).multiply(o),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix)}},e.prototype._collision=function(e){var t=this;this.colliders.forEach((function(n){var r=s.setFromMatrixPosition(n.matrixWorld),i=n.geometry.boundingSphere.radius,o=t.radius+i;if(e.distanceToSquared(r)<=o*o){var a=l.subVectors(e,r).normalize(),c=u.addVectors(r,a.multiplyScalar(o));e.copy(c.sub(t._worldPosition).normalize().multiplyScalar(t._worldBoneLength).add(t._worldPosition))}}))},e.prototype._getParentMatrixWorld=function(){return this.bone.parent?this.bone.parent.matrixWorld:o},e}();t.VRMSpringBone=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSpringBoneManager=void 0;var r=function(){function e(e,t){this.colliderGroups=[],this.springBoneGroupList=[],this.colliderGroups=e,this.springBoneGroupList=t}return e.prototype.lateUpdate=function(e){this.springBoneGroupList.forEach((function(t){t.forEach((function(t){t.update(e)}))}))},e.prototype.reset=function(){this.springBoneGroupList.forEach((function(e){e.forEach((function(e){e.reset()}))}))},e}();t.VRMSpringBoneManager=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSpringBoneImporterDebug=void 0;var s=n(9),l=n(52),u=n(28),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.import=function(e){return o(this,void 0,Promise,(function(){var t,n,r,i;return a(this,(function(o){switch(o.label){case 0:return(t=e.parser.json.extensions&&e.parser.json.extensions.VRM)&&(n=t.secondaryAnimation)?[4,this._importColliderMeshGroups(e,n)]:[2,null];case 1:return r=o.sent(),[4,this._importSpringBoneGroupList(e,n,r)];case 2:return i=o.sent(),[2,new l.VRMSpringBoneManagerDebug(r,i)]}}))}))},t.prototype._createSpringBone=function(e,t,n,r,i,o,a){return void 0===a&&(a=[]),new u.VRMSpringBoneDebug(e,t,n,r,i,o,a)},t}(s.VRMSpringBoneImporter);t.VRMSpringBoneImporterDebug=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSpringBoneDebug=void 0;var o=n(0),a=n(10),s=n(4),l=new o.Vector3,u=function(e){function t(t,n,r,i,o,a,s){return void 0===s&&(s=[]),e.call(this,t,n,r,i,o,a,s)||this}return i(t,e),t.prototype.getGizmo=function(){if(this._gizmo)return this._gizmo;var e=l.copy(this._nextTail).sub(this._worldPosition),t=e.length();return this._gizmo=new o.ArrowHelper(e.normalize(),this._worldPosition,t,16776960,this.radius,this.radius),this._gizmo.line.renderOrder=s.VRM_GIZMO_RENDER_ORDER,this._gizmo.cone.renderOrder=s.VRM_GIZMO_RENDER_ORDER,this._gizmo.line.material.depthTest=!1,this._gizmo.line.material.transparent=!0,this._gizmo.cone.material.depthTest=!1,this._gizmo.cone.material.transparent=!0,this._gizmo},t.prototype.update=function(t){e.prototype.update.call(this,t),this._updateGizmo()},t.prototype._updateGizmo=function(){if(this._gizmo){var e=l.copy(this._currentTail).sub(this._worldPosition),t=e.length();this._gizmo.setDirection(e.normalize()),this._gizmo.setLength(t,this.radius,this.radius),this._gizmo.position.copy(this._worldPosition)}},t}(a.VRMSpringBone);t.VRMSpringBoneDebug=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30);Object.assign(THREE,r)},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(31),t)},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(5),t),i(n(6),t),i(n(45),t),i(n(11),t),i(n(47),t),i(n(14),t),i(n(54),t),i(n(58),t),i(n(10),t),i(n(1),t),i(n(22),t)},function(e,t,n){"use strict";function r(e){Object.keys(e).forEach((function(t){var n=e[t];n&&n.isTexture&&n.dispose()})),e.dispose()}function i(e){var t=e.geometry;t&&t.dispose();var n=e.material;n&&(Array.isArray(n)?n.forEach((function(e){return r(e)})):n&&r(n))}Object.defineProperty(t,"__esModule",{value:!0}),t.deepDispose=void 0,t.deepDispose=function(e){e.traverse(i)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMBlendShapeImporter=void 0;var o=n(1),a=n(37),s=n(12),l=n(13),u=function(){function e(){}return e.prototype.import=function(e){return r(this,void 0,Promise,(function(){var t,n,u,c,d,h=this;return i(this,(function(p){switch(p.label){case 0:return(t=e.parser.json.extensions&&e.parser.json.extensions.VRM)&&(n=t.blendShapeMaster)?(u=new l.VRMBlendShapeProxy,(c=n.blendShapeGroups)?(d={},[4,Promise.all(c.map((function(t){return r(h,void 0,void 0,(function(){var n,l,c,h,p=this;return i(this,(function(f){return void 0===(n=t.name)?(console.warn("VRMBlendShapeImporter: One of blendShapeGroups has no name"),[2]):(t.presetName&&t.presetName!==o.VRMSchema.BlendShapePresetName.Unknown&&!d[t.presetName]&&(l=t.presetName,d[t.presetName]=n),c=new s.VRMBlendShapeGroup(n),e.scene.add(c),c.isBinary=t.isBinary||!1,t.binds&&t.binds.forEach((function(n){return r(p,void 0,void 0,(function(){var r,o,a;return i(this,(function(i){switch(i.label){case 0:return void 0===n.mesh||void 0===n.index?[2]:[4,e.parser.getDependency("mesh",n.mesh)];case 1:return r=i.sent(),o="Group"===r.type?r.children:[r],a=n.index,o.every((function(e){return Array.isArray(e.morphTargetInfluences)&&a<e.morphTargetInfluences.length}))?(c.addBind({meshes:o,morphTargetIndex:a,weight:n.weight||100}),[2]):(console.warn("VRMBlendShapeImporter: "+t.name+" attempts to index "+a+"th morph but not found."),[2])}}))}))})),(h=t.materialValues)&&h.forEach((function(t){if(void 0!==t.materialName&&void 0!==t.propertyName&&void 0!==t.targetValue){var n=[];e.scene.traverse((function(e){if(e.material){var r=e.material;Array.isArray(r)?n.push.apply(n,r.filter((function(e){return e.name===t.materialName&&-1===n.indexOf(e)}))):r.name===t.materialName&&-1===n.indexOf(r)&&n.push(r)}})),n.forEach((function(e){c.addMaterialValue({material:e,propertyName:a.renameMaterialProperty(t.propertyName),targetValue:t.targetValue})}))}})),u.registerBlendShapeGroup(n,l,c),[2])}))}))})))]):[2,u]):[2,null];case 1:return p.sent(),[2,u]}}))}))},e}();t.VRMBlendShapeImporter=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSchema=void 0,function(e){!function(e){e.A="a",e.Angry="angry",e.Blink="blink",e.BlinkL="blink_l",e.BlinkR="blink_r",e.E="e",e.Fun="fun",e.I="i",e.Joy="joy",e.Lookdown="lookdown",e.Lookleft="lookleft",e.Lookright="lookright",e.Lookup="lookup",e.Neutral="neutral",e.O="o",e.Sorrow="sorrow",e.U="u",e.Unknown="unknown"}(e.BlendShapePresetName||(e.BlendShapePresetName={})),function(e){e.BlendShape="BlendShape",e.Bone="Bone"}(e.FirstPersonLookAtTypeName||(e.FirstPersonLookAtTypeName={})),function(e){e.Chest="chest",e.Head="head",e.Hips="hips",e.Jaw="jaw",e.LeftEye="leftEye",e.LeftFoot="leftFoot",e.LeftHand="leftHand",e.LeftIndexDistal="leftIndexDistal",e.LeftIndexIntermediate="leftIndexIntermediate",e.LeftIndexProximal="leftIndexProximal",e.LeftLittleDistal="leftLittleDistal",e.LeftLittleIntermediate="leftLittleIntermediate",e.LeftLittleProximal="leftLittleProximal",e.LeftLowerArm="leftLowerArm",e.LeftLowerLeg="leftLowerLeg",e.LeftMiddleDistal="leftMiddleDistal",e.LeftMiddleIntermediate="leftMiddleIntermediate",e.LeftMiddleProximal="leftMiddleProximal",e.LeftRingDistal="leftRingDistal",e.LeftRingIntermediate="leftRingIntermediate",e.LeftRingProximal="leftRingProximal",e.LeftShoulder="leftShoulder",e.LeftThumbDistal="leftThumbDistal",e.LeftThumbIntermediate="leftThumbIntermediate",e.LeftThumbProximal="leftThumbProximal",e.LeftToes="leftToes",e.LeftUpperArm="leftUpperArm",e.LeftUpperLeg="leftUpperLeg",e.Neck="neck",e.RightEye="rightEye",e.RightFoot="rightFoot",e.RightHand="rightHand",e.RightIndexDistal="rightIndexDistal",e.RightIndexIntermediate="rightIndexIntermediate",e.RightIndexProximal="rightIndexProximal",e.RightLittleDistal="rightLittleDistal",e.RightLittleIntermediate="rightLittleIntermediate",e.RightLittleProximal="rightLittleProximal",e.RightLowerArm="rightLowerArm",e.RightLowerLeg="rightLowerLeg",e.RightMiddleDistal="rightMiddleDistal",e.RightMiddleIntermediate="rightMiddleIntermediate",e.RightMiddleProximal="rightMiddleProximal",e.RightRingDistal="rightRingDistal",e.RightRingIntermediate="rightRingIntermediate",e.RightRingProximal="rightRingProximal",e.RightShoulder="rightShoulder",e.RightThumbDistal="rightThumbDistal",e.RightThumbIntermediate="rightThumbIntermediate",e.RightThumbProximal="rightThumbProximal",e.RightToes="rightToes",e.RightUpperArm="rightUpperArm",e.RightUpperLeg="rightUpperLeg",e.Spine="spine",e.UpperChest="upperChest"}(e.HumanoidBoneName||(e.HumanoidBoneName={})),function(e){e.Everyone="Everyone",e.ExplicitlyLicensedPerson="ExplicitlyLicensedPerson",e.OnlyAuthor="OnlyAuthor"}(e.MetaAllowedUserName||(e.MetaAllowedUserName={})),function(e){e.Allow="Allow",e.Disallow="Disallow"}(e.MetaUssageName||(e.MetaUssageName={})),function(e){e.Cc0="CC0",e.CcBy="CC_BY",e.CcByNc="CC_BY_NC",e.CcByNcNd="CC_BY_NC_ND",e.CcByNcSa="CC_BY_NC_SA",e.CcByNd="CC_BY_ND",e.CcBySa="CC_BY_SA",e.Other="Other",e.RedistributionProhibited="Redistribution_Prohibited"}(e.MetaLicenseName||(e.MetaLicenseName={}))}(t.VRMSchema||(t.VRMSchema={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameMaterialProperty=void 0,t.renameMaterialProperty=function(e){return"_"!==e[0]?(console.warn('renameMaterialProperty: Given property name "'+e+'" might be invalid'),e):(e=e.substring(1),/[A-Z]/.test(e[0])?e[0].toLowerCase()+e.substring(1):(console.warn('renameMaterialProperty: Given property name "'+e+'" might be invalid'),e))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMFirstPersonImporter=void 0;var o=n(0),a=n(1),s=n(15),l=function(){function e(){}return e.prototype.import=function(e,t){return r(this,void 0,Promise,(function(){var n,r,l,u,c,d;return i(this,(function(i){switch(i.label){case 0:return(n=e.parser.json.extensions&&e.parser.json.extensions.VRM)&&(r=n.firstPerson)?void 0!==(l=r.firstPersonBone)&&-1!==l?[3,1]:(u=t.getBoneNode(a.VRMSchema.HumanoidBoneName.Head),[3,3]):[2,null];case 1:return[4,e.parser.getDependency("node",l)];case 2:u=i.sent(),i.label=3;case 3:return u?(c=r.firstPersonBoneOffset?new o.Vector3(r.firstPersonBoneOffset.x,r.firstPersonBoneOffset.y,-r.firstPersonBoneOffset.z):new o.Vector3(0,.06,0),d=[],[4,e.parser.getDependencies("mesh")]):(console.warn("VRMFirstPersonImporter: Could not find firstPersonBone of the VRM"),[2,null]);case 4:return i.sent().forEach((function(e,t){var n=r.meshAnnotations?r.meshAnnotations.find((function(e){return e.mesh===t})):void 0;d.push(new s.VRMRendererFirstPersonFlags(n&&n.firstPersonFlag,e))})),[2,new s.VRMFirstPerson(u,c,d)]}}))}))},e}();t.VRMFirstPersonImporter=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTexelDecodingFunction=t.getEncodingComponents=void 0;var r=n(0);t.getEncodingComponents=function(e){switch(e){case r.LinearEncoding:return["Linear","( value )"];case r.sRGBEncoding:return["sRGB","( value )"];case r.RGBEEncoding:return["RGBE","( value )"];case r.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case r.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case r.RGBDEncoding:return["RGBD","( value, 256.0 )"];case r.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}},t.getTexelDecodingFunction=function(e,n){var r=t.getEncodingComponents(n);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}},function(e,t,n){"use strict";n.r(t),t.default="// #define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n\n#include <common>\n\n// #include <uv_pars_vertex>\n#if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE ) || defined( USE_UVANIMMASKTEXTURE )\n  varying vec2 vUv;\n  uniform vec4 mainTex_ST;\n#endif\n\n#include <uv2_pars_vertex>\n// #include <displacementmap_pars_vertex>\n// #include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_OUTLINEWIDTHTEXTURE\n  uniform sampler2D outlineWidthTexture;\n#endif\n\nuniform float outlineWidth;\nuniform float outlineScaledMaxDistance;\n\nvoid main() {\n\n  // #include <uv_vertex>\n  #if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE ) || defined( USE_UVANIMMASKTEXTURE )\n    vUv = vec2( mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t );\n  #endif\n\n  #include <uv2_vertex>\n  #include <color_vertex>\n\n  #include <beginnormal_vertex>\n  #include <morphnormal_vertex>\n  #include <skinbase_vertex>\n  #include <skinnormal_vertex>\n\n  // we need this to compute the outline properly\n  objectNormal = normalize( objectNormal );\n\n  #include <defaultnormal_vertex>\n\n  #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n  #endif\n\n  #include <begin_vertex>\n\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  // #include <displacementmap_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n  #include <clipping_planes_vertex>\n\n  vViewPosition = - mvPosition.xyz;\n\n  float outlineTex = 1.0;\n\n  #ifdef OUTLINE\n    #ifdef USE_OUTLINEWIDTHTEXTURE\n      outlineTex = texture2D( outlineWidthTexture, vUv ).r;\n    #endif\n\n    #ifdef OUTLINE_WIDTH_WORLD\n      float worldNormalLength = length( transformedNormal );\n      vec3 outlineOffset = 0.01 * outlineWidth * outlineTex * worldNormalLength * objectNormal;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( outlineOffset + transformed, 1.0 );\n    #endif\n\n    #ifdef OUTLINE_WIDTH_SCREEN\n      vec3 clipNormal = ( projectionMatrix * modelViewMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n      vec2 projectedNormal = normalize( clipNormal.xy );\n      projectedNormal *= min( gl_Position.w, outlineScaledMaxDistance );\n      projectedNormal.x *= projectionMatrix[ 0 ].x / projectionMatrix[ 1 ].y;\n      gl_Position.xy += 0.01 * outlineWidth * outlineTex * projectedNormal.xy;\n    #endif\n\n    gl_Position.z += 1E-6 * gl_Position.w; // anti-artifact magic\n  #endif\n\n  #include <worldpos_vertex>\n  // #include <envmap_vertex>\n  #include <shadowmap_vertex>\n  #include <fog_vertex>\n\n}"},function(e,t,n){"use strict";n.r(t),t.default="// #define PHONG\n\n#ifdef BLENDMODE_CUTOUT\n  uniform float cutoff;\n#endif\n\nuniform vec3 color;\nuniform float colorAlpha;\nuniform vec3 shadeColor;\n#ifdef USE_SHADETEXTURE\n  uniform sampler2D shadeTexture;\n#endif\n\nuniform float receiveShadowRate;\n#ifdef USE_RECEIVESHADOWTEXTURE\n  uniform sampler2D receiveShadowTexture;\n#endif\n\nuniform float shadingGradeRate;\n#ifdef USE_SHADINGGRADETEXTURE\n  uniform sampler2D shadingGradeTexture;\n#endif\n\nuniform float shadeShift;\nuniform float shadeToony;\nuniform float lightColorAttenuation;\nuniform float indirectLightIntensity;\n\n#ifdef USE_RIMTEXTURE\n  uniform sampler2D rimTexture;\n#endif\nuniform vec3 rimColor;\nuniform float rimLightingMix;\nuniform float rimFresnelPower;\nuniform float rimLift;\n\n#ifdef USE_SPHEREADD\n  uniform sampler2D sphereAdd;\n#endif\n\nuniform vec3 emissionColor;\n\nuniform vec3 outlineColor;\nuniform float outlineLightingMix;\n\n#ifdef USE_UVANIMMASKTEXTURE\n  uniform sampler2D uvAnimMaskTexture;\n#endif\n\nuniform float uvAnimOffsetX;\nuniform float uvAnimOffsetY;\nuniform float uvAnimTheta;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n// #include <uv_pars_fragment>\n#if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE ) || defined( USE_UVANIMMASKTEXTURE )\n  varying vec2 vUv;\n#endif\n\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n// #include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n// #include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n// #include <envmap_pars_fragment>\n// #include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n\n// #include <lights_phong_pars_fragment>\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n\n#define Material_LightProbeLOD( material ) (0)\n\n#include <shadowmap_pars_fragment>\n// #include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n  uniform sampler2D normalMap;\n  uniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n  uniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && defined ( TANGENTSPACE_NORMALMAP )\n\n  // Per-Pixel Tangent Space Normal Mapping\n  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n  // three-vrm specific change: it requires `uv` as an input in order to support uv scrolls\n\n  vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n    vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n    vec2 st0 = dFdx( uv.st );\n    vec2 st1 = dFdy( uv.st );\n\n    float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n    vec3 S = ( q0 * st1.t - q1 * st0.t ) * scale;\n    vec3 T = ( - q0 * st1.s + q1 * st0.s ) * scale;\n\n    // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0\n    // TODO: Is this still required? Or shall I make a PR about it?\n\n    if ( length( S ) == 0.0 || length( T ) == 0.0 ) {\n      return surf_norm;\n    }\n\n    S = normalize( S );\n    T = normalize( T );\n    vec3 N = normalize( surf_norm );\n\n    #ifdef DOUBLE_SIDED\n\n      // Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331\n\n      bool frontFacing = dot( cross( S, T ), N ) > 0.0;\n\n      mapN.xy *= ( float( frontFacing ) * 2.0 - 1.0 );\n\n    #else\n\n      mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n    #endif\n\n    mat3 tsn = mat3( S, T, N );\n    return normalize( tsn * mapN );\n\n  }\n\n#endif\n\n// #include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// == lighting stuff ===========================================================\nfloat getLightIntensity(\n  const in IncidentLight directLight,\n  const in GeometricContext geometry,\n  const in float shadow,\n  const in float shadingGrade\n) {\n  float lightIntensity = dot( geometry.normal, directLight.direction );\n  lightIntensity = 0.5 + 0.5 * lightIntensity;\n  lightIntensity = lightIntensity * shadow;\n  lightIntensity = lightIntensity * shadingGrade;\n  lightIntensity = lightIntensity * 2.0 - 1.0;\n  return shadeToony == 1.0\n    ? step( shadeShift, lightIntensity )\n    : smoothstep( shadeShift, shadeShift + ( 1.0 - shadeToony ), lightIntensity );\n}\n\nvec3 getLighting( const in vec3 lightColor ) {\n  vec3 lighting = lightColor;\n  lighting = mix(\n    lighting,\n    vec3( max( 0.001, max( lighting.x, max( lighting.y, lighting.z ) ) ) ),\n    lightColorAttenuation\n  );\n\n  #ifndef PHYSICALLY_CORRECT_LIGHTS\n    lighting *= PI;\n  #endif\n\n  return lighting;\n}\n\nvec3 getDiffuse(\n  const in vec3 lit,\n  const in vec3 shade,\n  const in float lightIntensity,\n  const in vec3 lighting\n) {\n  #ifdef DEBUG_LITSHADERATE\n    return vec3( BRDF_Diffuse_Lambert( lightIntensity * lighting ) );\n  #endif\n\n  return lighting * BRDF_Diffuse_Lambert( mix( shade, lit, lightIntensity ) );\n}\n\nvec3 calcDirectDiffuse(\n  const in vec2 uv,\n  const in vec3 lit,\n  const in vec3 shade,\n  in GeometricContext geometry,\n  inout ReflectedLight reflectedLight\n) {\n  IncidentLight directLight;\n  vec3 lightingSum = vec3( 0.0 );\n\n  float shadingGrade = 1.0;\n  #ifdef USE_SHADINGGRADETEXTURE\n    shadingGrade = 1.0 - shadingGradeRate * ( 1.0 - texture2D( shadingGradeTexture, uv ).r );\n  #endif\n\n  float receiveShadow = receiveShadowRate;\n  #ifdef USE_RECEIVESHADOWTEXTURE\n    receiveShadow *= texture2D( receiveShadowTexture, uv ).a;\n  #endif\n\n  #if ( NUM_POINT_LIGHTS > 0 )\n    PointLight pointLight;\n\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n      pointLight = pointLights[ i ];\n      getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n      float atten = 1.0;\n      #ifdef USE_SHADOWMAP\n        atten = all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n      #endif\n\n      float shadow = 1.0 - receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );\n      float lightIntensity = getLightIntensity( directLight, geometry, shadow, shadingGrade );\n      vec3 lighting = getLighting( directLight.color );\n      reflectedLight.directDiffuse += getDiffuse( lit, shade, lightIntensity, lighting );\n      lightingSum += lighting;\n    }\n  #endif\n\n  #if ( NUM_SPOT_LIGHTS > 0 )\n    SpotLight spotLight;\n\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n      spotLight = spotLights[ i ];\n      getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n      float atten = 1.0;\n      #ifdef USE_SHADOWMAP\n        atten = all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n      #endif\n\n      float shadow = 1.0 - receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );\n      float lightIntensity = getLightIntensity( directLight, geometry, shadow, shadingGrade );\n      vec3 lighting = getLighting( directLight.color );\n      reflectedLight.directDiffuse += getDiffuse( lit, shade, lightIntensity, lighting );\n      lightingSum += lighting;\n    }\n  #endif\n\n  #if ( NUM_DIR_LIGHTS > 0 )\n    DirectionalLight directionalLight;\n\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n      directionalLight = directionalLights[ i ];\n      getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n      float atten = 1.0;\n      #ifdef USE_SHADOWMAP\n        atten = all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n      #endif\n\n      float shadow = 1.0 - receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );\n      float lightIntensity = getLightIntensity( directLight, geometry, shadow, shadingGrade );\n      vec3 lighting = getLighting( directLight.color );\n      reflectedLight.directDiffuse += getDiffuse( lit, shade, lightIntensity, lighting );\n      lightingSum += lighting;\n    }\n  #endif\n\n  return lightingSum;\n}\n\n// == post correction ==========================================================\nvoid postCorrection() {\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n  #include <premultiplied_alpha_fragment>\n  #include <dithering_fragment>\n}\n\n// == main procedure ===========================================================\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec2 uv = vec2(0.5, 0.5);\n\n  #if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE ) || defined( USE_UVANIMMASKTEXTURE )\n    uv = vUv;\n\n    float uvAnimMask = 1.0;\n    #ifdef USE_UVANIMMASKTEXTURE\n      uvAnimMask = texture2D( uvAnimMaskTexture, uv ).x;\n    #endif\n\n    uv = uv + vec2( uvAnimOffsetX, uvAnimOffsetY ) * uvAnimMask;\n    float uvRotCos = cos( uvAnimTheta * uvAnimMask );\n    float uvRotSin = sin( uvAnimTheta * uvAnimMask );\n    uv = mat2( uvRotCos, uvRotSin, -uvRotSin, uvRotCos ) * ( uv - 0.5 ) + 0.5;\n  #endif\n\n  #ifdef DEBUG_UV\n    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n    #if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE ) || defined( USE_UVANIMMASKTEXTURE )\n      gl_FragColor = vec4( uv, 0.0, 1.0 );\n    #endif\n    return;\n  #endif\n\n  vec4 diffuseColor = vec4( color, colorAlpha );\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n  vec3 totalEmissiveRadiance = emissionColor;\n\n  #include <logdepthbuf_fragment>\n\n  // #include <map_fragment>\n  #ifdef USE_MAP\n    diffuseColor *= mapTexelToLinear( texture2D( map, uv ) );\n  #endif\n\n  #include <color_fragment>\n  // #include <alphamap_fragment>\n\n  // -- MToon: alpha -----------------------------------------------------------\n  // #include <alphatest_fragment>\n  #ifdef BLENDMODE_CUTOUT\n    if ( diffuseColor.a <= cutoff ) { discard; }\n    diffuseColor.a = 1.0;\n  #endif\n\n  #ifdef BLENDMODE_OPAQUE\n    diffuseColor.a = 1.0;\n  #endif\n\n  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_FIXED ) // omitting DebugMode\n    gl_FragColor = vec4( outlineColor, diffuseColor.a );\n    postCorrection();\n    return;\n  #endif\n\n  // #include <specularmap_fragment>\n  #include <normal_fragment_begin>\n\n  #ifdef OUTLINE\n    normal *= -1.0;\n  #endif\n\n  // #include <normal_fragment_maps>\n\n  #ifdef OBJECTSPACE_NORMALMAP\n\n    normal = texture2D( normalMap, uv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n    #ifdef FLIP_SIDED\n\n      normal = - normal;\n\n    #endif\n\n    #ifdef DOUBLE_SIDED\n\n      normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n    #endif\n\n    normal = normalize( normalMatrix * normal );\n\n  #elif defined( TANGENTSPACE_NORMALMAP )\n\n    vec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;\n    mapN.xy *= normalScale;\n\n    #ifdef USE_TANGENT\n\n      normal = normalize( vTBN * mapN );\n\n    #else\n\n      normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN );\n\n    #endif\n\n  #endif\n\n  // #include <emissivemap_fragment>\n  #ifdef USE_EMISSIVEMAP\n    totalEmissiveRadiance *= emissiveMapTexelToLinear( texture2D( emissiveMap, uv ) ).rgb;\n  #endif\n\n  #ifdef DEBUG_NORMAL\n    gl_FragColor = vec4( 0.5 + 0.5 * normal, 1.0 );\n    return;\n  #endif\n\n  // -- MToon: lighting --------------------------------------------------------\n  // accumulation\n  // #include <lights_phong_fragment>\n  // #include <lights_fragment_begin>\n  vec3 lit = diffuseColor.rgb;\n  vec3 shade = shadeColor;\n  #ifdef USE_SHADETEXTURE\n    shade *= shadeTextureTexelToLinear( texture2D( shadeTexture, uv ) ).rgb;\n  #endif\n\n  GeometricContext geometry;\n\n  geometry.position = - vViewPosition;\n  geometry.normal = normal;\n  geometry.viewDir = normalize( vViewPosition );\n\n  vec3 lighting = calcDirectDiffuse( uv, diffuseColor.rgb, shade, geometry, reflectedLight );\n\n  vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n  #if ( NUM_HEMI_LIGHTS > 0 )\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n      irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n    }\n  #endif\n\n  // #include <lights_fragment_maps>\n  #ifdef USE_LIGHTMAP\n    vec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).rgb * lightMapIntensity;\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n      lightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n    #endif\n    irradiance += lightMapIrradiance;\n  #endif\n\n  // #include <lights_fragment_end>\n  reflectedLight.indirectDiffuse += indirectLightIntensity * irradiance * BRDF_Diffuse_Lambert( lit );\n\n  // modulation\n  #include <aomap_fragment>\n\n  vec3 col = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\n  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_MIXED )\n    gl_FragColor = vec4(\n      outlineColor.rgb * mix( vec3( 1.0 ), col, outlineLightingMix ),\n      diffuseColor.a\n    );\n    postCorrection();\n    return;\n  #endif\n\n  #ifdef DEBUG_LITSHADERATE\n    gl_FragColor = vec4( col, diffuseColor.a );\n    postCorrection();\n    return;\n  #endif\n\n  // -- MToon: parametric rim lighting -----------------------------------------\n  vec3 viewDir = normalize( vViewPosition );\n  vec3 rimMix = mix(vec3(1.0), lighting + indirectLightIntensity * irradiance, rimLightingMix);\n  vec3 rim = rimColor * pow( saturate( 1.0 - dot( viewDir, normal ) + rimLift ), rimFresnelPower );\n  #ifdef USE_RIMTEXTURE\n    rim *= rimTextureTexelToLinear( texture2D( rimTexture, uv ) ).rgb;\n  #endif\n  col += rim;\n\n  // -- MToon: additive matcap -------------------------------------------------\n  #ifdef USE_SPHEREADD\n    {\n      vec3 x = normalize( vec3( viewDir.z, 0.0, -viewDir.x ) );\n      vec3 y = cross( viewDir, x ); // guaranteed to be normalized\n      vec2 sphereUv = 0.5 + 0.5 * vec2( dot( x, normal ), -dot( y, normal ) );\n      vec3 matcap = sphereAddTexelToLinear( texture2D( sphereAdd, sphereUv ) ).xyz;\n      col += matcap;\n    }\n  #endif\n\n  // -- MToon: Emission --------------------------------------------------------\n  col += totalEmissiveRadiance;\n\n  // #include <envmap_fragment>\n\n  // -- Almost done! -----------------------------------------------------------\n  gl_FragColor = vec4( col, diffuseColor.a );\n  postCorrection();\n}"},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMMaterialImporter=void 0;var a=n(0),s=n(23),l=n(24),u=function(){function e(e){void 0===e&&(e={}),this._encoding=e.encoding||a.LinearEncoding,this._encoding!==a.LinearEncoding&&this._encoding!==a.sRGBEncoding&&console.warn("The specified color encoding might not work properly with VRMMaterialImporter. You might want to use THREE.sRGBEncoding instead."),this._requestEnvMap=e.requestEnvMap}return e.prototype.convertGLTFMaterials=function(e){return r(this,void 0,Promise,(function(){var t,n,o,a,s,l=this;return i(this,(function(u){switch(u.label){case 0:return(t=e.parser.json.extensions&&e.parser.json.extensions.VRM)&&(n=t.materialProperties)?[4,e.parser.getDependencies("mesh")]:[2,null];case 1:return o=u.sent(),a={},s=[],[4,Promise.all(o.map((function(t,o){return r(l,void 0,void 0,(function(){var l,u,c=this;return i(this,(function(d){switch(d.label){case 0:return l=e.parser.json.meshes[o],u="Group"===t.type?t.children:[t],[4,Promise.all(u.map((function(t,o){return r(c,void 0,void 0,(function(){var r,u,c,d,h,p;return i(this,(function(i){switch(i.label){case 0:return(r=l.primitives[o])?(u=t.geometry,c=u.index?u.index.count:u.attributes.position.count/3,Array.isArray(t.material)||(t.material=[t.material],u.addGroup(0,c,0)),d=r.material,(h=n[d])||(console.warn("VRMMaterialImporter: There are no material definition for material #"+d+" on VRM extension."),h={shader:"VRM_USE_GLTFSHADER"}),a[d]?(p=a[d],[3,3]):[3,1]):[2];case 1:return[4,this.createVRMMaterials(t.material[0],h,e)];case 2:p=i.sent(),a[d]=p,s.push(p.surface),p.outline&&s.push(p.outline),i.label=3;case 3:return t.material[0]=p.surface,this._requestEnvMap&&p.surface.isMeshStandardMaterial&&this._requestEnvMap().then((function(e){p.surface.envMap=e,p.surface.needsUpdate=!0})),t.renderOrder=h.renderQueue||2e3,p.outline&&(t.material[1]=p.outline,u.addGroup(0,c,1)),[2]}}))}))})))];case 1:return d.sent(),[2]}}))}))})))];case 2:return u.sent(),[2,s]}}))}))},e.prototype.createVRMMaterials=function(e,t,n){return r(this,void 0,Promise,(function(){var r,o,a,u,c=this;return i(this,(function(i){switch(i.label){case 0:return"VRM/MToon"!==t.shader?[3,2]:[4,this._extractMaterialProperties(e,t,n)];case 1:return a=i.sent(),["srcBlend","dstBlend","isFirstSetup"].forEach((function(e){void 0!==a[e]&&delete a[e]})),["mainTex","shadeTexture","emissionMap","sphereAdd","rimTexture"].forEach((function(e){void 0!==a[e]&&(a[e].encoding=c._encoding)})),a.encoding=this._encoding,r=new s.MToonMaterial(a),a.outlineWidthMode!==s.MToonMaterialOutlineWidthMode.None&&(a.isOutline=!0,o=new s.MToonMaterial(a)),[3,11];case 2:return"VRM/UnlitTexture"!==t.shader?[3,4]:[4,this._extractMaterialProperties(e,t,n)];case 3:return(u=i.sent()).renderType=l.VRMUnlitMaterialRenderType.Opaque,r=new l.VRMUnlitMaterial(u),[3,11];case 4:return"VRM/UnlitCutout"!==t.shader?[3,6]:[4,this._extractMaterialProperties(e,t,n)];case 5:return(u=i.sent()).renderType=l.VRMUnlitMaterialRenderType.Cutout,r=new l.VRMUnlitMaterial(u),[3,11];case 6:return"VRM/UnlitTransparent"!==t.shader?[3,8]:[4,this._extractMaterialProperties(e,t,n)];case 7:return(u=i.sent()).renderType=l.VRMUnlitMaterialRenderType.Transparent,r=new l.VRMUnlitMaterial(u),[3,11];case 8:return"VRM/UnlitTransparentZWrite"!==t.shader?[3,10]:[4,this._extractMaterialProperties(e,t,n)];case 9:return(u=i.sent()).renderType=l.VRMUnlitMaterialRenderType.TransparentWithZWrite,r=new l.VRMUnlitMaterial(u),[3,11];case 10:"VRM_USE_GLTFSHADER"!==t.shader&&console.warn('Unknown shader detected: "'+t.shader+'"'),r=this._convertGLTFMaterial(e.clone()),i.label=11;case 11:return r.name=e.name,r.userData=JSON.parse(JSON.stringify(e.userData)),r.userData.vrmMaterialProperties=t,o&&(o.name=e.name+" (Outline)",o.userData=JSON.parse(JSON.stringify(e.userData)),o.userData.vrmMaterialProperties=t),[2,{surface:r,outline:o}]}}))}))},e.prototype._renameMaterialProperty=function(e){return"_"!==e[0]?(console.warn('VRMMaterials: Given property name "'+e+'" might be invalid'),e):(e=e.substring(1),/[A-Z]/.test(e[0])?e[0].toLowerCase()+e.substring(1):(console.warn('VRMMaterials: Given property name "'+e+'" might be invalid'),e))},e.prototype._convertGLTFMaterial=function(e){var t;e.isMeshStandardMaterial&&((t=e).map&&(t.map.encoding=this._encoding),t.emissiveMap&&(t.emissiveMap.encoding=this._encoding),this._encoding===a.LinearEncoding&&(t.color.convertLinearToSRGB(),t.emissive.convertLinearToSRGB()));e.isMeshBasicMaterial&&((t=e).map&&(t.map.encoding=this._encoding),this._encoding===a.LinearEncoding&&t.color.convertLinearToSRGB());return e},e.prototype._extractMaterialProperties=function(e,t,n){var r=[],i={};if(t.textureProperties)for(var l=function(e){var o=u._renameMaterialProperty(e),a=t.textureProperties[e];r.push(n.parser.getDependency("texture",a).then((function(e){i[o]=e})))},u=this,c=0,d=Object.keys(t.textureProperties);c<d.length;c++){l(f=d[c])}if(t.floatProperties)for(var h=0,p=Object.keys(t.floatProperties);h<p.length;h++){var f=p[h],m=this._renameMaterialProperty(f);i[m]=t.floatProperties[f]}if(t.vectorProperties)for(var _=function(e){var n,r=v._renameMaterialProperty(e);["_MainTex","_ShadeTexture","_BumpMap","_ReceiveShadowTexture","_ShadingGradeTexture","_RimTexture","_SphereAdd","_EmissionMap","_OutlineWidthTexture","_UvAnimMaskTexture"].some((function(t){return e===t}))&&(r+="_ST"),i[r]=new((n=a.Vector4).bind.apply(n,o([void 0],t.vectorProperties[e])))},v=this,g=0,y=Object.keys(t.vectorProperties);g<y.length;g++){_(f=y[g])}return t.keywordMap._ALPHATEST_ON&&i.blendMode===s.MToonMaterialRenderMode.Opaque&&(i.blendMode=s.MToonMaterialRenderMode.Cutout),i.skinning=e.skinning||!1,i.morphTargets=e.morphTargets||!1,i.morphNormals=e.morphNormals||!1,Promise.all(r).then((function(){return i}))},e}();t.VRMMaterialImporter=u},function(e,t,n){"use strict";n.r(t),t.default="#include <common>\n\n// #include <uv_pars_vertex>\n#ifdef USE_MAP\n  varying vec2 vUv;\n  uniform vec4 mainTex_ST;\n#endif\n\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n  // #include <uv_vertex>\n  #ifdef USE_MAP\n    vUv = vec2( mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t );\n  #endif\n\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n\n  #ifdef USE_ENVMAP\n\n  #include <beginnormal_vertex>\n  #include <morphnormal_vertex>\n  #include <skinnormal_vertex>\n  #include <defaultnormal_vertex>\n\n  #endif\n\n  #include <begin_vertex>\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <envmap_vertex>\n  #include <fog_vertex>\n\n}"},function(e,t,n){"use strict";n.r(t),t.default="#ifdef RENDERTYPE_CUTOUT\n  uniform float cutoff;\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n// #include <alphamap_pars_fragment>\n// #include <aomap_pars_fragment>\n// #include <lightmap_pars_fragment>\n// #include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n// #include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// == main procedure ===========================================================\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec4 diffuseColor = vec4( 1.0 );\n\n  #include <logdepthbuf_fragment>\n\n  // #include <map_fragment>\n  #ifdef USE_MAP\n    diffuseColor *= mapTexelToLinear( texture2D( map, vUv ) );\n  #endif\n\n  #include <color_fragment>\n  // #include <alphamap_fragment>\n\n  // MToon: alpha\n  // #include <alphatest_fragment>\n  #ifdef RENDERTYPE_CUTOUT\n    if ( diffuseColor.a <= cutoff ) { discard; }\n    diffuseColor.a = 1.0;\n  #endif\n\n  #ifdef RENDERTYPE_OPAQUE\n    diffuseColor.a = 1.0;\n  #endif\n\n  // #include <specularmap_fragment>\n\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n  // accumulation (baked indirect lighting only)\n  #ifdef USE_LIGHTMAP\n    reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n  #else\n    reflectedLight.indirectDiffuse += vec3( 1.0 );\n  #endif\n\n  // modulation\n  // #include <aomap_fragment>\n\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n  vec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n  // #include <envmap_fragment>\n\n  gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRMUtils=void 0;var r=n(46),i=function(){function e(){}return e.removeUnnecessaryJoints=r.removeUnnecessaryJoints,e}();t.VRMUtils=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeUnnecessaryJoints=void 0;var r=n(0);t.removeUnnecessaryJoints=function(e){var t=new Map;e.traverse((function(e){if("SkinnedMesh"===e.type){var n=e,i=n.geometry.getAttribute("skinIndex"),o=t.get(i);if(!o){for(var a=[],s=[],l={},u=i.array,c=0;c<u.length;c++){var d=u[c];void 0===l[d]&&(l[d]=a.length,a.push(n.skeleton.bones[d]),s.push(n.skeleton.boneInverses[d])),u[c]=l[d]}i.copyArray(u),i.needsUpdate=!0,o=new r.Skeleton(a,s),t.set(i,o)}n.bind(o,new r.Matrix4)}}))}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(48),t),i(n(4),t),i(n(28),t),i(n(27),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VRMImporterDebug=void 0;var s=n(6),l=n(4),u=n(50),c=n(27),d=function(e){function t(t){void 0===t&&(t={});return t.lookAtImporter=t.lookAtImporter||new u.VRMLookAtImporterDebug,t.springBoneImporter=t.springBoneImporter||new c.VRMSpringBoneImporterDebug,e.call(this,t)||this}return i(t,e),t.prototype.import=function(e,t){return void 0===t&&(t={}),o(this,void 0,Promise,(function(){var n,r,i,o,s,u,c,d,h,p;return a(this,(function(a){switch(a.label){case 0:if(void 0===e.parser.json.extensions||void 0===e.parser.json.extensions.VRM)throw new Error("Could not find VRM extension on the GLTF");return n=e.parser.json.extensions.VRM,(r=e.scene).updateMatrixWorld(!1),r.traverse((function(e){e.isMesh&&(e.frustumCulled=!1)})),[4,this._materialImporter.convertGLTFMaterials(e)];case 1:return i=a.sent()||void 0,[4,this._humanoidImporter.import(e)];case 2:return(o=a.sent()||void 0)?[4,this._firstPersonImporter.import(e,o)]:[3,4];case 3:return u=a.sent()||void 0,[3,5];case 4:u=void 0,a.label=5;case 5:return s=u,[4,this._blendShapeImporter.import(e)];case 6:return c=a.sent()||void 0,s&&c&&o?[4,this._lookAtImporter.import(e,s,c,o)]:[3,8];case 7:return h=a.sent()||void 0,[3,9];case 8:h=void 0,a.label=9;case 9:return(d=h).setupHelper&&d.setupHelper(r,t),[4,this._springBoneImporter.import(e)];case 10:return(p=a.sent()||void 0).setupHelper&&p.setupHelper(r,t),[2,new l.VRMDebug({scene:e.scene,meta:n.meta,materials:i,humanoid:o,firstPerson:s,blendShapeProxy:c,lookAt:d,springBoneManager:p},t)]}}))}))},t}(s.VRMImporter);t.VRMImporterDebug=d},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtImporterDebug=void 0;var o=n(7),a=n(51),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.import=function(e,t,n,r){var i=e.parser.json.extensions&&e.parser.json.extensions.VRM;if(!i)return null;var o=i.firstPerson;if(!o)return null;var s=this._importApplyer(o,n,r);return new a.VRMLookAtHeadDebug(t,s||void 0)},t}(o.VRMLookAtImporter);t.VRMLookAtImporterDebug=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMLookAtHeadDebug=void 0;var o=n(0),a=n(3),s=new o.Vector3,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.setupHelper=function(e,t){t.disableFaceDirectionHelper||(this._faceDirectionHelper=new o.ArrowHelper(new o.Vector3(0,0,-1),new o.Vector3(0,0,0),.5,16711935),e.add(this._faceDirectionHelper))},t.prototype.update=function(t){e.prototype.update.call(this,t),this._faceDirectionHelper&&(this.firstPerson.getFirstPersonWorldPosition(this._faceDirectionHelper.position),this._faceDirectionHelper.setDirection(this.getLookAtWorldDirection(s)))},t}(a.VRMLookAtHead);t.VRMLookAtHeadDebug=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VRMSpringBoneManagerDebug=void 0;var o=n(0),a=n(10),s=n(4),l=new o.MeshBasicMaterial({color:16711935,wireframe:!0,transparent:!0,depthTest:!1}),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.setupHelper=function(e,t){t.disableSpringBoneHelper||(this.springBoneGroupList.forEach((function(t){t.forEach((function(t){if(t.getGizmo){var n=t.getGizmo();e.add(n)}}))})),this.colliderGroups.forEach((function(e){e.colliders.forEach((function(e){e.material=l,e.renderOrder=s.VRM_GIZMO_RENDER_ORDER}))})))},t}(a.VRMSpringBoneManager);t.VRMSpringBoneManagerDebug=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(17),t),i(n(55),t),i(n(56),t),i(n(57),t),i(n(18),t),i(n(16),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(19),t),i(n(8),t),i(n(20),t),i(n(21),t),i(n(3),t),i(n(7),t)}]);
var __three_vrm__=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t){e.exports=THREE},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(11))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(36)),i(n(13))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(8),s=n(9),l=n(10),u=n(34),c=n(35),d=n(2),h=n(11),p=function(){function e(){}return e.prototype.loadHumanoid=function(e){return i(this,void 0,void 0,function(){var t,n=this;return r(this,function(o){switch(o.label){case 0:return(t=e.parser.json.extensions&&e.parser.json.extensions.VRM&&e.parser.json.extensions.VRM.humanoid&&e.parser.json.extensions.VRM.humanoid.humanBones)?[4,t.reduce(function(t,o){return i(n,void 0,void 0,function(){var n,i,a,s,l;return r(this,function(r){switch(r.label){case 0:return[4,t];case 1:return n=r.sent(),i=o.node,a=o.bone,void 0===i||void 0===a?[3,3]:(s=n,l=a,[4,e.parser.getDependency("node",i)]);case 2:s[l]=r.sent(),r.label=3;case 3:return[2,n]}})})},Promise.resolve({}))]:(console.warn("Could not find humanBones field on the VRM file"),[2,null]);case 1:return[2,o.sent()]}})})},e.prototype.loadFirstPerson=function(e,t,n){return i(this,void 0,void 0,function(){var i,a,l,u,c;return r(this,function(r){switch(r.label){case 0:return(i=void 0===e.firstPersonBone||-1===e.firstPersonBone)?(l=t[h.HumanBone.Head],[3,3]):[3,1];case 1:return[4,n.parser.getDependency("node",e.firstPersonBone)];case 2:l=r.sent(),r.label=3;case 3:return(a=l)?(u=!i&&e.firstPersonBoneOffset?new o.Vector3(e.firstPersonBoneOffset.x,e.firstPersonBoneOffset.y,e.firstPersonBoneOffset.z):new o.Vector3(0,.06,0),c=[],[4,n.parser.getDependencies("mesh")]):(console.warn("Could not find firstPersonBone of the VRM"),[2,null]);case 4:return r.sent().forEach(function(t,n){var i=e.meshAnnotations?e.meshAnnotations.find(function(e){return e.mesh===n}):void 0;c.push(new s.RendererFirstPersonFlags(i&&i.firstPersonFlag,t))}),[2,new s.VRMFirstPerson(a,u,c)]}})})},e.prototype.loadLookAt=function(e,t,n){var i=e.lookAtHorizontalInner,r=e.lookAtHorizontalOuter,o=e.lookAtVerticalDown,a=e.lookAtVerticalUp;switch(e.lookAtTypeName){case h.LookAtTypeName.Bone:return void 0===i||void 0===r||void 0===o||void 0===a?new l.VRMLookAtHead(n):new l.VRMLookAtHead(n,new c.VRMLookAtBoneApplyer(n,i,r,o,a));case h.LookAtTypeName.BlendShape:return void 0===r||void 0===o||void 0===a?new l.VRMLookAtHead(n):new l.VRMLookAtHead(n,new u.VRMLookAtBlendShapeApplyer(t,r,o,a));default:return new l.VRMLookAtHead(n)}},e.prototype.loadBlendShapeMaster=function(e,t){return i(this,void 0,void 0,function(){var n,o,s,l=this;return r(this,function(u){return(n=t.parser.json.extensions&&t.parser.json.extensions.VRM&&t.parser.json.extensions.VRM.blendShapeMaster&&t.parser.json.extensions.VRM.blendShapeMaster.blendShapeGroups)?(o=new a.BlendShapeMaster,s={},n.forEach(function(e){return i(l,void 0,void 0,function(){var n,l,u,c=this;return r(this,function(d){return void 0===(n=e.name)?(console.warn("createBlendShapeMasterFromVRM: One of blendShapeGroups has no name"),[2]):(e.presetName&&e.presetName!==h.BlendShapePresetName.Unknown&&!s[e.presetName]&&(s[e.presetName]=e.name),l=new a.BlendShapeController(n),t.scene.add(l),l.isBinary=e.isBinary||!1,Array.isArray(e.binds)&&e.binds.forEach(function(n){return i(c,void 0,void 0,function(){var i,o,a;return r(this,function(r){switch(r.label){case 0:return void 0===n.mesh||void 0===n.index?[2]:[4,t.parser.getDependency("mesh",n.mesh)];case 1:return i=r.sent(),o="Group"===i.type?i.children:[i],a=n.index,o.every(function(e){return Array.isArray(e.morphTargetInfluences)&&a<e.morphTargetInfluences.length})?(l.addBind({meshes:o,morphTargetIndex:a,weight:n.weight||100}),[2]):(console.warn("createBlendShapeMasterFromVRM: "+e.name+" attempts to index "+a+"th morph but not found."),[2])}})})}),u=e.materialValues,Array.isArray(u)&&u.forEach(function(e){if(void 0!==e.materialName&&void 0!==e.propertyName&&void 0!==e.targetValue){var n=[];t.scene.traverse(function(t){if(t.material){var i=t.material;Array.isArray(i)?n.push.apply(n,i.filter(function(t){return t.name===e.materialName&&-1===n.indexOf(t)})):i.name===e.materialName&&-1===n.indexOf(i)&&n.push(i)}}),n.forEach(function(t){l.addMaterialValue({material:t,propertyName:c.renameMaterialProperty(e.propertyName),targetValue:e.targetValue})})}}),o.registerBlendShapeGroup(n,l),[2])})})}),[2,a.VRMBlendShapeProxy.create(e,o,s)]):[2,null]})})},e.prototype.loadSecondary=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return[4,(t=new d.VRMSpringBoneManager).loadGLTF(e)];case 1:return n.sent(),[2,t]}})})},e.prototype.renameMaterialProperty=function(e){return"_"!==e[0]?(console.warn('VRMMaterials: Given property name "'+e+'" might be invalid'),e):(e=e.substring(1),/[A-Z]/.test(e[0])?e[0].toLowerCase()+e.substring(1):(console.warn('VRMMaterials: Given property name "'+e+'" might be invalid'),e))},e}();t.VRMPartsBuilder=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.linstep=function(e,t,n){return e<=t?0:e>=n?1:(e-t)/(n-t)};var r=new i.Vector3,o=new i.Vector3,a=new i.Quaternion;t.getWorldPositionLite=function(e,t){return e.matrixWorld.decompose(t,a,o),t},t.getWorldScaleLite=function(e,t){return e.matrixWorld.decompose(r,a,t),t},t.getWorldQuaternionLite=function(e,t){return e.matrixWorld.decompose(r,t,o),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t,n){this.lookAtHorizontalOuter=e,this.lookAtVerticalDown=t,this.lookAtVerticalUp=n}}();t.VRMLookAtApplyer=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(7),s=n(28),l=n(3),u=function(){function e(){this._materialConverter=new a.MaterialConverter(!0),this._partsBuilder=new l.VRMPartsBuilder}return e.prototype.materialConverter=function(e){return this._materialConverter=e,this},e.prototype.partsBuilder=function(e){return this._partsBuilder=e,this},e.prototype.build=function(e){return i(this,void 0,void 0,function(){var t,n;return r(this,function(i){switch(i.label){case 0:return t=new c(this._partsBuilder),[4,this._materialConverter.convertGLTFMaterials(e)];case 1:return n=i.sent(),[4,t.loadGLTF(n)];case 2:return i.sent(),[2,t]}})})},e}();t.VRMBuilder=u;var c=function(){function e(e){this._partsBuilder=e||new l.VRMPartsBuilder}return Object.defineProperty(e,"Builder",{get:function(){return new u},enumerable:!0,configurable:!0}),e.from=function(e){return(new u).build(e)},Object.defineProperty(e.prototype,"restPose",{get:function(){return this._restPose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"humanBones",{get:function(){return this._humanBones},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendShapeProxy",{get:function(){return this._blendShapeProxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstPerson",{get:function(){return this._firstPerson},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookAt",{get:function(){return this._lookAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meta",{get:function(){return this._meta},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationMixer",{get:function(){return this._animationMixer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"springBoneManager",{get:function(){return this._springBoneManager},enumerable:!0,configurable:!0}),e.prototype.loadGLTF=function(e){return i(this,void 0,void 0,function(){var t,n,i,a,s,l,u=this;return r(this,function(r){switch(r.label){case 0:if(this._gltf=e,void 0===e.parser.json.extensions||void 0===e.parser.json.extensions.VRM)throw new Error("Could not find VRM extension on the GLTF");return t=e.parser.json.extensions.VRM,this._meta=t.meta,e.scene.updateMatrixWorld(!1),e.scene.traverse(function(e){e.isMesh&&(e.frustumCulled=!1)}),e.scene.traverse(function(e){if("SkinnedMesh"===e.type){var t=e,n=t.geometry.clone();t.geometry=n;var i=n.getAttribute("skinIndex"),r=[],a=[],s={},l=i.array.map(function(e){return void 0===s[e]&&(s[e]=r.length,r.push(t.skeleton.bones[e]),a.push(t.skeleton.boneInverses[e])),s[e]});n.removeAttribute("skinIndex"),n.addAttribute("skinIndex",new o.BufferAttribute(l,4,!1)),t.bind(new o.Skeleton(r,a),new o.Matrix4)}}),[4,this._partsBuilder.loadHumanoid(e)];case 1:return n=r.sent(),this._humanBones=n,i=this,this.humanBones?[4,this._partsBuilder.loadFirstPerson(t.firstPerson,this.humanBones,e)]:[3,3];case 2:return a=r.sent(),[3,4];case 3:a=null,r.label=4;case 4:return i._firstPerson=a,this._animationMixer=new o.AnimationMixer(e.scene),[4,this._partsBuilder.loadBlendShapeMaster(this.animationMixer,e)];case 5:if(!(s=r.sent()))throw new Error("failed to create blendShape. confirm your vrm file");return this._blendShapeProxy=s,l=this,[4,this._partsBuilder.loadSecondary(e)];case 6:return l._springBoneManager=r.sent(),this._lookAt=this.blendShapeProxy&&this.humanBones?this._partsBuilder.loadLookAt(t.firstPerson,this.blendShapeProxy,this.humanBones):null,this._restPose=this.humanBones?Object.keys(this.humanBones).reduce(function(e,t){var n=u.humanBones[t];return e[t]={position:n.position.toArray(),rotation:n.quaternion.toArray()},e},{}):null,[2]}})})},e.prototype.setPose=function(e){var t=this;this.humanBones?Object.keys(e).forEach(function(n){var i=e[n],r=t.humanBones[n];if(r){var o=t.restPose[n];o&&(i.position&&r.position.set(o.position[0]+i.position[0],o.position[1]+i.position[1],o.position[2]+i.position[2]),i.rotation&&r.quaternion.fromArray(i.rotation))}}):console.warn("This VRM cannot be posed since humanBones are not properly set")},Object.defineProperty(e.prototype,"scene",{get:function(){return this._gltf&&this._gltf.scene},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.lookAt&&this.lookAt.update(),this.animationMixer&&this.animationMixer.update(e),this.blendShapeProxy&&this.blendShapeProxy.update(),this.springBoneManager&&this.springBoneManager.lateUpdate(e)},e.prototype.dispose=function(){var e=this.scene;if(e)for(;e.children.length>0;){var t=e.children[e.children.length-1];s.deepDispose(t),e.remove(t)}},e}();t.VRM=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(20))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(29)),i(n(30)),i(n(31))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(32))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(33)),i(n(5))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.A="a",e.Angry="angry",e.Blink="blink",e.BlinkL="blink_l",e.BlinkR="blink_r",e.E="e",e.Fun="fun",e.I="i",e.Joy="joy",e.Lookdown="lookdown",e.Lookleft="lookleft",e.Lookright="lookright",e.Lookup="lookup",e.Neutral="neutral",e.O="o",e.Sorrow="sorrow",e.U="u",e.Unknown="unknown"}(t.BlendShapePresetName||(t.BlendShapePresetName={})),function(e){e.BlendShape="BlendShape",e.Bone="Bone"}(t.LookAtTypeName||(t.LookAtTypeName={})),function(e){e.Chest="chest",e.Head="head",e.Hips="hips",e.Jaw="jaw",e.LeftEye="leftEye",e.LeftFoot="leftFoot",e.LeftHand="leftHand",e.LeftIndexDistal="leftIndexDistal",e.LeftIndexIntermediate="leftIndexIntermediate",e.LeftIndexProximal="leftIndexProximal",e.LeftLittleDistal="leftLittleDistal",e.LeftLittleIntermediate="leftLittleIntermediate",e.LeftLittleProximal="leftLittleProximal",e.LeftLowerArm="leftLowerArm",e.LeftLowerLeg="leftLowerLeg",e.LeftMiddleDistal="leftMiddleDistal",e.LeftMiddleIntermediate="leftMiddleIntermediate",e.LeftMiddleProximal="leftMiddleProximal",e.LeftRingDistal="leftRingDistal",e.LeftRingIntermediate="leftRingIntermediate",e.LeftRingProximal="leftRingProximal",e.LeftShoulder="leftShoulder",e.LeftThumbDistal="leftThumbDistal",e.LeftThumbIntermediate="leftThumbIntermediate",e.LeftThumbProximal="leftThumbProximal",e.LeftToes="leftToes",e.LeftUpperArm="leftUpperArm",e.LeftUpperLeg="leftUpperLeg",e.Neck="neck",e.RightEye="rightEye",e.RightFoot="rightFoot",e.RightHand="rightHand",e.RightIndexDistal="rightIndexDistal",e.RightIndexIntermediate="rightIndexIntermediate",e.RightIndexProximal="rightIndexProximal",e.RightLittleDistal="rightLittleDistal",e.RightLittleIntermediate="rightLittleIntermediate",e.RightLittleProximal="rightLittleProximal",e.RightLowerArm="rightLowerArm",e.RightLowerLeg="rightLowerLeg",e.RightMiddleDistal="rightMiddleDistal",e.RightMiddleIntermediate="rightMiddleIntermediate",e.RightMiddleProximal="rightMiddleProximal",e.RightRingDistal="rightRingDistal",e.RightRingIntermediate="rightRingIntermediate",e.RightRingProximal="rightRingProximal",e.RightShoulder="rightShoulder",e.RightThumbDistal="rightThumbDistal",e.RightThumbIntermediate="rightThumbIntermediate",e.RightThumbProximal="rightThumbProximal",e.RightToes="rightToes",e.RightUpperArm="rightUpperArm",e.RightUpperLeg="rightUpperLeg",e.Spine="spine",e.UpperChest="upperChest"}(t.HumanBone||(t.HumanBone={})),function(e){e.Everyone="Everyone",e.ExplicitlyLicensedPerson="ExplicitlyLicensedPerson",e.OnlyAuthor="OnlyAuthor"}(t.AllowedUserName||(t.AllowedUserName={})),function(e){e.Allow="Allow",e.Disallow="Disallow"}(t.UssageName||(t.UssageName={})),function(e){e.Cc0="CC0",e.CcBy="CC_BY",e.CcByNc="CC_BY_NC",e.CcByNcNd="CC_BY_NC_ND",e.CcByNcSa="CC_BY_NC_SA",e.CcByNd="CC_BY_ND",e.CcBySa="CC_BY_SA",e.Other="Other",e.RedistributionProhibited="Redistribution_Prohibited"}(t.LicenseName||(t.LicenseName={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEG2RAD=Math.PI/180;var i=function(){function e(e,t,n){this.curve=[0,0,0,1,1,1,1,0],this.curveXRangeDegree=90,this.curveYRangeDegree=10,void 0!==e&&(this.curveXRangeDegree=e),void 0!==t&&(this.curveYRangeDegree=t),void 0!==n&&(this.curve=n)}return e.apply=function(t){return new e(t.xRange,t.yRange,t.curve)},e.prototype.map=function(e){var t=Math.min(Math.max(e,0),this.curveXRangeDegree)/this.curveXRangeDegree;return this.curveYRangeDegree*function(e,t){if(e.length<8)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be 8 at least)");if(e.length%4!=0)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be multiples of 4");for(var n=0;;){if(e.length<=4*n)return e[4*n-3];if(t<=e[4*n])break;n++}var i=n-1;if(i<0)return e[4*i+5];var r=e[4*i],o=(t-r)/(e[4*n]-r);return function(e,t,n,i,r){var o=r*r*r,a=r*r;return e+(t-e)*(-2*o+3*a)+n*(o-2*a+r)+i*(o-a)}(e[4*i+1],e[4*n+1],e[4*i+3],e[4*n+2],o)}(this.curve,t)},e}();t.CurveMapper=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(4);t.GIZMO_RENDER_ORDER=1e4,t.IDENTITY_MATRIX4=Object.freeze(new i.Matrix4);var o=Object.freeze(new i.Quaternion),a=new i.Vector3,s=new i.Vector3,l=new i.Vector3,u=new i.Quaternion,c=new i.Matrix4,d=new i.Matrix4,h=function(){function e(e,t,n,r,o,s,l){var u=this;void 0===l&&(l=[]),this.bone=e,this.bone.matrixAutoUpdate=!1,this.radius=t,this.stiffnessForce=n,this.gravityDir=r,this.gravityPower=o,this.dragForce=s,this.colliders=l,this.worldPosition=(new i.Vector3).setFromMatrixPosition(this.bone.matrixWorld),this._parentWorldRotation=new i.Quaternion,this._initialLocalMatrix=this.bone.matrix.clone(),this._initialLocalRotation=this.bone.quaternion.clone(),this._initialLocalChildPosition=0===u.bone.children.length?u.bone.position.clone().normalize().multiplyScalar(.07):u.bone.children[0].position.clone(),this.currentTail=this.bone.localToWorld(this._initialLocalChildPosition.clone()),this.prevTail=this.currentTail.clone(),this.nextTail=this.currentTail.clone(),this.boneAxis=this._initialLocalChildPosition.clone().normalize(),this.worldBoneLength=this.bone.localToWorld(a.copy(this._initialLocalChildPosition)).sub(this.worldPosition).length()}return e.prototype.reset=function(){this.bone.matrix.copy(this._initialLocalMatrix),this.bone.localToWorld(this.currentTail.copy(this._initialLocalChildPosition)),this.prevTail.copy(this.currentTail),this.nextTail.copy(this.currentTail),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this.getParentMatrixWorld(),this.bone.matrix),this.worldPosition.setFromMatrixPosition(this.bone.matrixWorld)},e.prototype.update=function(e){if(!(e<=0)){this.bone.matrixWorld.multiplyMatrices(this.getParentMatrixWorld(),this.bone.matrix),this.bone.parent?r.getWorldQuaternionLite(this.bone.parent,this._parentWorldRotation):this._parentWorldRotation.copy(o),this.worldPosition.setFromMatrixPosition(this.bone.matrixWorld);var t=this.stiffnessForce*e,n=s.copy(this.gravityDir).multiplyScalar(this.gravityPower*e);this.nextTail.copy(this.currentTail).add(a.copy(this.currentTail).sub(this.prevTail).multiplyScalar(1-this.dragForce)).add(a.copy(this.boneAxis).applyMatrix4(this._initialLocalMatrix).applyMatrix4(this.getParentMatrixWorld()).sub(this.worldPosition).normalize().multiplyScalar(t)).add(n),this.nextTail.sub(this.worldPosition).normalize().multiplyScalar(this.worldBoneLength).add(this.worldPosition),this.collision(this.nextTail),this.prevTail.copy(this.currentTail),this.currentTail.copy(this.nextTail);var i=c.getInverse(d.copy(this.getParentMatrixWorld()).multiply(this._initialLocalMatrix)),l=u.setFromUnitVectors(this.boneAxis,a.copy(this.nextTail).applyMatrix4(i).normalize());this.bone.quaternion.copy(this._initialLocalRotation).multiply(l),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this.getParentMatrixWorld(),this.bone.matrix)}},e.prototype.collision=function(e){var t=this;this.colliders.forEach(function(n){var i=a.setFromMatrixPosition(n.matrixWorld),r=n.geometry.boundingSphere.radius,o=t.radius+r;if(e.distanceToSquared(i)<=o*o){var u=s.subVectors(e,i).normalize(),c=l.addVectors(i,u.multiplyScalar(o));e.copy(c.sub(t.worldPosition).normalize().multiplyScalar(t.worldBoneLength).add(t.worldPosition))}})},e.prototype.getParentMatrixWorld=function(){return this.bone.parent?this.bone.parent.matrixWorld:t.IDENTITY_MATRIX4},e}();t.VRMSpringBone=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=n(15),u=function(e){function t(t,n){var i=e.call(this)||this;return i.target=t,i.debugOption=n,i}return r(t,e),t.prototype.loadHumanoid=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.target.loadHumanoid(e)];case 1:return[2,t.sent()]}})})},t.prototype.loadFirstPerson=function(e,t,n){return o(this,void 0,void 0,function(){return a(this,function(i){switch(i.label){case 0:return[4,this.target.loadFirstPerson(e,t,n)];case 1:return[2,i.sent()]}})})},t.prototype.loadLookAt=function(e,t,n){return this.target.loadLookAt(e,t,n)},t.prototype.loadBlendShapeMaster=function(e,t){return o(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return[4,this.target.loadBlendShapeMaster(e,t)];case 1:return[2,n.sent()]}})})},t.prototype.loadSecondary=function(e){return o(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.debugOption&&this.debugOption.disableSpringBoneHelper?[4,this.target.loadSecondary(e)]:[3,2];case 1:return[2,n.sent()];case 2:return[4,(t=new l.VRMSpringBoneManagerDebug).loadGLTF(e)];case 3:return n.sent(),[2,t]}})})},t}(s.VRMPartsBuilder);t.VRMPartsBuilderDebugProxy=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(16),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isColiderMeshVisible=function(){return!0},t.prototype.createSpringBone=function(e,t,n,i,r,o,s,l){void 0===l&&(l=[]);var u=new a.VRMSpringBoneDebug(t,n,i,r,o,s,l);return e.scene.add(u.getGizmo()),u},t}(o.VRMSpringBoneManager);t.VRMSpringBoneManagerDebug=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(2),s=new o.Vector3,l=function(e){function t(t,n,i,r,o,a,s){return void 0===s&&(s=[]),e.call(this,t,n,i,r,o,a,s)||this}return r(t,e),t.prototype.getGizmo=function(){if(this._gizmo)return this._gizmo;var e=s.copy(this.nextTail).sub(this.worldPosition),t=e.length();return this._gizmo=new o.ArrowHelper(e.normalize(),this.worldPosition,t,16776960,this.radius,this.radius),this._gizmo.line.renderOrder=a.GIZMO_RENDER_ORDER,this._gizmo.cone.renderOrder=a.GIZMO_RENDER_ORDER,this._gizmo.line.material.depthTest=!1,this._gizmo.line.material.transparent=!0,this._gizmo.cone.material.depthTest=!1,this._gizmo.cone.material.transparent=!0,this._gizmo},t.prototype.update=function(t){e.prototype.update.call(this,t),this.updateGizmo()},t.prototype.updateGizmo=function(){if(this._gizmo){var e=s.copy(this.currentTail).sub(this.worldPosition),t=e.length();this._gizmo.setDirection(e.normalize()),this._gizmo.setLength(t,this.radius,this.radius),this._gizmo.position.copy(this.worldPosition)}},t}(a.VRMSpringBone);t.VRMSpringBoneDebug=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(18);Object.assign(THREE,i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(19))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(6)),i(n(3)),i(n(8)),i(n(37)),i(n(9)),i(n(39)),i(n(10)),i(n(2)),i(n(1)),i(n(7))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(21),s=n(25),l=function(){function e(e,t){void 0===t&&(t={}),this._colorSpaceGamma=e,this._options=t}return e.prototype.convertGLTFMaterials=function(e){return i(this,void 0,void 0,function(){var t,n,o=this;return r(this,function(a){switch(a.label){case 0:return[4,e.parser.getDependencies("mesh")];case 1:return t=a.sent(),n={},[4,Promise.all(t.map(function(t,a){return i(o,void 0,void 0,function(){var o,s=this;return r(this,function(l){switch(l.label){case 0:return o="Group"===t.type?t.children:[t],[4,Promise.all(o.map(function(t,o){return i(s,void 0,void 0,function(){var i,s,l;return r(this,function(r){switch(r.label){case 0:return Array.isArray(t.material)||(t.material=[t.material],t.geometry.addGroup(0,t.geometry.index.count,0)),i=e.parser.json.meshes[a].primitives[o].material,s=e.parser.json.extensions.VRM.materialProperties[i],n[i]?(l=n[i],[3,3]):[3,1];case 1:return[4,this.createVRMMaterials(t.material[0],s,e)];case 2:l=r.sent(),n[i]=l,r.label=3;case 3:return t.material[0]=l.surface,this._options.requestEnvMap&&this._options.requestEnvMap().then(function(e){l.surface.envMap=e,l.surface.needsUpdate=!0}),t.renderOrder=s.renderQueue||2e3,l.outline&&(t.material[1]=l.outline,t.geometry.addGroup(0,t.geometry.index.count,1)),t.onBeforeRender=function(){t.material.forEach(function(e){e.applyUniforms&&e.applyUniforms()})},[2]}})})}))];case 1:return l.sent(),[2]}})})}))];case 2:return a.sent(),[2,e]}})})},e.prototype.createVRMMaterials=function(e,t,n){return i(this,void 0,void 0,function(){var i,l,u,c,d=this;return r(this,function(r){switch(r.label){case 0:return"VRM/MToon"!==t.shader?[3,2]:[4,this.extractMaterialProperties(e,t,n)];case 1:return u=r.sent(),["srcBlend","dstBlend","isFirstSetup"].forEach(function(e){void 0!==u[e]&&delete u[e]}),["mainTex","shadeTexture","emission","sphereAdd"].forEach(function(e){void 0!==u[e]&&(u[e].encoding=d._colorSpaceGamma?o.LinearEncoding:o.sRGBEncoding)}),i=new a.MToon(this._colorSpaceGamma,u),u.outlineWidthMode!==a.MToonOutlineWidthMode.None&&(u.isOutline=!0,l=new a.MToon(this._colorSpaceGamma,u)),[3,11];case 2:return"VRM/UnlitTexture"!==t.shader?[3,4]:[4,this.extractMaterialProperties(e,t,n)];case 3:return(c=r.sent()).renderType=s.UnlitRenderType.Opaque,i=new s.Unlit(c),[3,11];case 4:return"VRM/UnlitCutout"!==t.shader?[3,6]:[4,this.extractMaterialProperties(e,t,n)];case 5:return(c=r.sent()).renderType=s.UnlitRenderType.Cutout,i=new s.Unlit(c),[3,11];case 6:return"VRM/UnlitTransparent"!==t.shader?[3,8]:[4,this.extractMaterialProperties(e,t,n)];case 7:return(c=r.sent()).renderType=s.UnlitRenderType.Transparent,i=new s.Unlit(c),[3,11];case 8:return"VRM/UnlitTransparentZWrite"!==t.shader?[3,10]:[4,this.extractMaterialProperties(e,t,n)];case 9:return(c=r.sent()).renderType=s.UnlitRenderType.TransparentWithZWrite,i=new s.Unlit(c),[3,11];case 10:"VRM_USE_GLTFSHADER"!==t.shader&&console.warn('Unknown shader detected: "'+t.shader+'"'),i=this.convertGLTFMaterial(e.clone()),r.label=11;case 11:return i.name=e.name,i.userData=JSON.parse(JSON.stringify(e.userData)),i.userData.vrmMaterialProperties=t,l&&(l.name=e.name+" (Outline)",l.userData=JSON.parse(JSON.stringify(e.userData)),l.userData.vrmMaterialProperties=t),[2,{surface:i,outline:l}]}})})},e.prototype.renameMaterialProperty=function(e){return"_"!==e[0]?(console.warn('VRMMaterials: Given property name "'+e+'" might be invalid'),e):(e=e.substring(1),/[A-Z]/.test(e[0])?e[0].toLowerCase()+e.substring(1):(console.warn('VRMMaterials: Given property name "'+e+'" might be invalid'),e))},e.prototype.convertGLTFMaterial=function(e){if(e.isMeshStandardMaterial){var t=e;this._colorSpaceGamma?(t.map&&(t.map.encoding=o.LinearEncoding),t.emissiveMap&&(t.emissiveMap.encoding=o.LinearEncoding)):(t.color.convertSRGBToLinear(),t.emissive.convertSRGBToLinear())}if(e.isMeshBasicMaterial){t=e;this._colorSpaceGamma?t.map&&(t.map.encoding=o.LinearEncoding):t.color.convertSRGBToLinear()}return e},e.prototype.extractMaterialProperties=function(e,t,n){var i=[],r={};if(t.textureProperties)for(var s=function(e){var o=l.renameMaterialProperty(e),a=t.textureProperties[e];i.push(n.parser.getDependency("texture",a).then(function(e){r[o]=e}))},l=this,u=0,c=Object.keys(t.textureProperties);u<c.length;u++){s(c[u])}if(t.floatProperties)for(var d=0,h=Object.keys(t.floatProperties);d<h.length;d++){var p=h[d],f=this.renameMaterialProperty(p);r[f]=t.floatProperties[p]}if(t.vectorProperties)for(var m=function(e){var n,i=g.renameMaterialProperty(e);["_MainTex","_ShadeTexture","_BumpMap","_ReceiveShadowTexture","_ShadingGradeTexture","_SphereAdd","_EmissionMap","_OutlineWidthTexture"].some(function(t){return e===t})&&(i+="_ST"),r[i]=new((n=o.Vector4).bind.apply(n,[void 0].concat(t.vectorProperties[e])))},g=this,y=0,_=Object.keys(t.vectorProperties);y<_.length;y++){m(_[y])}return t.keywordMap._ALPHATEST_ON&&r.blendMode===a.MToonRenderMode.Opaque&&(r.blendMode=a.MToonRenderMode.Cutout),r.skinning=e.skinning||!1,r.morphTargets=e.morphTargets||!1,r.morphNormals=e.morphNormals||!1,Promise.all(i).then(function(){return r})},e}();t.MaterialConverter=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s,l,u,c=n(0),d=n(22),h=function(e){function t(t,n){var i=e.call(this)||this;return i.isVRMMToon=!0,i.cutoff=.5,i.color=new c.Vector4(1,1,1,1),i.shadeColor=new c.Vector4(.97,.81,.86,1),i.map=null,i.mainTex_ST=new c.Vector4(0,0,1,1),i.shadeTexture=null,i.bumpScale=1,i.normalMap=null,i.receiveShadowRate=1,i.receiveShadowTexture=null,i.shadingGradeRate=1,i.shadingGradeTexture=null,i.shadeShift=0,i.shadeToony=.9,i.lightColorAttenuation=0,i.indirectLightIntensity=.1,i.rimTexture=null,i.rimColor=new c.Vector4(0,0,0,1),i.rimLightingMix=0,i.rimFresnelPower=1,i.rimLift=0,i.sphereAdd=null,i.emissionColor=new c.Vector4(0,0,0,1),i.emissiveMap=null,i.outlineWidthTexture=null,i.outlineWidth=.5,i.outlineScaledMaxDistance=1,i.outlineColor=new c.Vector4(0,0,0,1),i.outlineLightingMix=1,i.shouldApplyUniforms=!0,i._debugMode=a.None,i._blendMode=u.Opaque,i._outlineWidthMode=l.None,i._outlineColorMode=s.FixedColor,i._cullMode=o.Back,i._outlineCullMode=o.Front,i._isOutline=!1,i._colorSpaceGamma=t,void 0===n&&(n={}),["shadeTexture_ST","bumpMap_ST","receiveShadowTexture_ST","shadingGradeTexture_ST","sphereAdd_ST","emissionMap_ST","outlineWidthTexture_ST","srcBlend","dstBlend"].forEach(function(e){void 0!==n[e]&&delete n[e]}),n.fog=!0,n.lights=!0,n.clipping=!0,n.skinning=n.skinning||!1,n.morphTargets=n.morphTargets||!1,n.morphNormals=n.morphNormals||!1,n.uniforms=c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.normalmap,c.UniformsLib.emissivemap,c.UniformsLib.fog,c.UniformsLib.lights,{cutoff:{value:.5},color:{value:new c.Color(1,1,1)},colorAlpha:{value:1},shadeColor:{value:new c.Color(.97,.81,.86)},mainTex_ST:{value:new c.Vector4(0,0,1,1)},shadeTexture:{value:null},bumpScale:{value:1},receiveShadowRate:{value:1},receiveShadowTexture:{value:null},shadingGradeRate:{value:1},shadingGradeTexture:{value:null},shadeShift:{value:0},shadeToony:{value:.9},lightColorAttenuation:{value:0},indirectLightIntensity:{value:.1},rimTexture:{value:null},rimColor:{value:new c.Color(0,0,0)},rimLightingMix:{value:0},rimFresnelPower:{value:1},rimLift:{value:0},sphereAdd:{value:null},emissionColor:{value:new c.Color(0,0,0)},outlineWidthTexture:{value:null},outlineWidth:{value:.5},outlineScaledMaxDistance:{value:1},outlineColor:{value:new c.Color(0,0,0)},outlineLightingMix:{value:1}}]),i.setValues(n),i.updateShaderCode(),i}return r(t,e),Object.defineProperty(t.prototype,"mainTex",{get:function(){return this.map},set:function(e){this.map=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bumpMap",{get:function(){return this.normalMap},set:function(e){this.normalMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emissionMap",{get:function(){return this.emissiveMap},set:function(e){this.emissiveMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this._blendMode=e,this.depthWrite=this._blendMode!==u.Transparent,this.transparent=this._blendMode===u.Transparent||this._blendMode===u.TransparentWithZWrite,this.updateShaderCode()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debugMode",{get:function(){return this._debugMode},set:function(e){this._debugMode=e,this.updateShaderCode()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidthMode",{get:function(){return this._outlineWidthMode},set:function(e){this._outlineWidthMode=e,this.updateShaderCode()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineColorMode",{get:function(){return this._outlineColorMode},set:function(e){this._outlineColorMode=e,this.updateShaderCode()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cullMode",{get:function(){return this._cullMode},set:function(e){this._cullMode=e,this.updateCullFace()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineCullMode",{get:function(){return this._outlineCullMode},set:function(e){this._outlineCullMode=e,this.updateCullFace()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zWrite",{get:function(){return this.depthWrite?1:0},set:function(e){this.depthWrite=.5<=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOutline",{get:function(){return this._isOutline},set:function(e){this._isOutline=e,this.updateShaderCode(),this.updateCullFace()},enumerable:!0,configurable:!0}),t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.cutoff=t.cutoff,this.color.copy(t.color),this.shadeColor.copy(t.shadeColor),this.map=t.map,this.mainTex_ST.copy(t.mainTex_ST),this.shadeTexture=t.shadeTexture,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.receiveShadowRate=t.receiveShadowRate,this.receiveShadowTexture=t.receiveShadowTexture,this.shadingGradeRate=t.shadingGradeRate,this.shadingGradeTexture=t.shadingGradeTexture,this.shadeShift=t.shadeShift,this.shadeToony=t.shadeToony,this.lightColorAttenuation=t.lightColorAttenuation,this.indirectLightIntensity=t.indirectLightIntensity,this.rimTexture=t.rimTexture,this.rimColor.copy(t.rimColor),this.rimLightingMix=t.rimLightingMix,this.rimFresnelPower=t.rimFresnelPower,this.rimLift=t.rimLift,this.sphereAdd=t.sphereAdd,this.emissionColor.copy(t.emissionColor),this.emissiveMap=t.emissiveMap,this.outlineWidthTexture=t.outlineWidthTexture,this.outlineWidth=t.outlineWidth,this.outlineScaledMaxDistance=t.outlineScaledMaxDistance,this.outlineColor.copy(t.outlineColor),this.outlineLightingMix=t.outlineLightingMix,this.debugMode=t.debugMode,this.blendMode=t.blendMode,this.outlineWidthMode=t.outlineWidthMode,this.outlineColorMode=t.outlineColorMode,this.cullMode=t.cullMode,this.outlineCullMode=t.outlineCullMode,this.isOutline=t.isOutline,this},t.prototype.applyUniforms=function(){this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.color.value.setRGB(this.color.x,this.color.y,this.color.z),this._colorSpaceGamma||this.uniforms.color.value.convertSRGBToLinear(),this.uniforms.colorAlpha.value=this.color.w,this.uniforms.shadeColor.value.setRGB(this.shadeColor.x,this.shadeColor.y,this.shadeColor.z),this._colorSpaceGamma||this.uniforms.shadeColor.value.convertSRGBToLinear(),this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST),this.uniforms.shadeTexture.value=this.shadeTexture,this.uniforms.bumpScale.value=this.bumpScale,this.uniforms.normalMap.value=this.normalMap,this.uniforms.receiveShadowRate.value=this.receiveShadowRate,this.uniforms.receiveShadowTexture.value=this.receiveShadowTexture,this.uniforms.shadingGradeRate.value=this.shadingGradeRate,this.uniforms.shadingGradeTexture.value=this.shadingGradeTexture,this.uniforms.shadeShift.value=this.shadeShift,this.uniforms.shadeToony.value=this.shadeToony,this.uniforms.lightColorAttenuation.value=this.lightColorAttenuation,this.uniforms.indirectLightIntensity.value=this.indirectLightIntensity,this.uniforms.rimTexture.value=this.rimTexture,this.uniforms.rimColor.value.setRGB(this.rimColor.x,this.rimColor.y,this.rimColor.z),this._colorSpaceGamma||this.uniforms.rimColor.value.convertSRGBToLinear(),this.uniforms.rimLightingMix.value=this.rimLightingMix,this.uniforms.rimFresnelPower.value=this.rimFresnelPower,this.uniforms.rimLift.value=this.rimLift,this.uniforms.sphereAdd.value=this.sphereAdd,this.uniforms.emissionColor.value.setRGB(this.emissionColor.x,this.emissionColor.y,this.emissionColor.z),this._colorSpaceGamma||this.uniforms.emissionColor.value.convertSRGBToLinear(),this.uniforms.emissiveMap.value=this.emissiveMap,this.uniforms.outlineWidthTexture.value=this.outlineWidthTexture,this.uniforms.outlineWidth.value=this.outlineWidth,this.uniforms.outlineScaledMaxDistance.value=this.outlineScaledMaxDistance,this.uniforms.outlineColor.value.setRGB(this.outlineColor.x,this.outlineColor.y,this.outlineColor.z),this._colorSpaceGamma||this.uniforms.outlineColor.value.convertSRGBToLinear(),this.uniforms.outlineLightingMix.value=this.outlineLightingMix,this.updateCullFace())},t.prototype.updateShaderCode=function(){this.defines={OUTLINE:this._isOutline,BLENDMODE_OPAQUE:this._blendMode===u.Opaque,BLENDMODE_CUTOUT:this._blendMode===u.Cutout,BLENDMODE_TRANSPARENT:this._blendMode===u.Transparent||this._blendMode===u.TransparentWithZWrite,USE_SHADETEXTURE:null!==this.shadeTexture,USE_RECEIVESHADOWTEXTURE:null!==this.receiveShadowTexture,USE_SHADINGGRADETEXTURE:null!==this.shadingGradeTexture,USE_RIMTEXTURE:null!==this.rimTexture,USE_SPHEREADD:null!==this.sphereAdd,USE_OUTLINEWIDTHTEXTURE:null!==this.outlineWidthTexture,DEBUG_NORMAL:this._debugMode===a.Normal,DEBUG_LITSHADERATE:this._debugMode===a.LitShadeRate,DEBUG_UV:this._debugMode===a.UV,OUTLINE_WIDTH_WORLD:this._outlineWidthMode===l.WorldCoordinates,OUTLINE_WIDTH_SCREEN:this._outlineWidthMode===l.ScreenCoordinates,OUTLINE_COLOR_FIXED:this._outlineColorMode===s.FixedColor,OUTLINE_COLOR_MIXED:this._outlineColorMode===s.MixedLighting};var e=(null!==this.shadeTexture?d.getTexelDecodingFunction("shadeTextureTexelToLinear",this.shadeTexture.encoding)+"\n":"")+(null!==this.sphereAdd?d.getTexelDecodingFunction("sphereAddTexelToLinear",this.sphereAdd.encoding)+"\n":"");this.vertexShader=n(23),this.fragmentShader=e+n(24),this.needsUpdate=!0},t.prototype.updateCullFace=function(){this.isOutline?this.outlineCullMode===o.Off?this.side=c.DoubleSide:this.outlineCullMode===o.Front?this.side=c.BackSide:this.outlineCullMode===o.Back&&(this.side=c.FrontSide):this.cullMode===o.Off?this.side=c.DoubleSide:this.cullMode===o.Front?this.side=c.BackSide:this.cullMode===o.Back&&(this.side=c.FrontSide)},t}(c.ShaderMaterial);t.MToon=h,function(e){e[e.Off=0]="Off",e[e.Front=1]="Front",e[e.Back=2]="Back"}(o=t.MToonCullMode||(t.MToonCullMode={})),function(e){e[e.None=0]="None",e[e.Normal=1]="Normal",e[e.LitShadeRate=2]="LitShadeRate",e[e.UV=3]="UV"}(a=t.MToonDebugMode||(t.MToonDebugMode={})),function(e){e[e.FixedColor=0]="FixedColor",e[e.MixedLighting=1]="MixedLighting"}(s=t.MToonOutlineColorMode||(t.MToonOutlineColorMode={})),function(e){e[e.None=0]="None",e[e.WorldCoordinates=1]="WorldCoordinates",e[e.ScreenCoordinates=2]="ScreenCoordinates"}(l=t.MToonOutlineWidthMode||(t.MToonOutlineWidthMode={})),function(e){e[e.Opaque=0]="Opaque",e[e.Cutout=1]="Cutout",e[e.Transparent=2]="Transparent",e[e.TransparentWithZWrite=3]="TransparentWithZWrite"}(u=t.MToonRenderMode||(t.MToonRenderMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.getEncodingComponents=function(e){switch(e){case i.LinearEncoding:return["Linear","( value )"];case i.sRGBEncoding:return["sRGB","( value )"];case i.RGBEEncoding:return["RGBE","( value )"];case i.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case i.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case i.RGBDEncoding:return["RGBD","( value, 256.0 )"];case i.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}},t.getTexelDecodingFunction=function(e,n){var i=t.getEncodingComponents(n);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}},function(e,t){e.exports="// #define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n\n#include <common>\n\n// #include <uv_pars_vertex>\n#if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE )\n  varying vec2 vUv;\n  uniform vec4 mainTex_ST;\n#endif\n\n#include <uv2_pars_vertex>\n// #include <displacementmap_pars_vertex>\n// #include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_OUTLINEWIDTHTEXTURE\n  uniform sampler2D outlineWidthTexture;\n#endif\n\nuniform float outlineWidth;\nuniform float outlineScaledMaxDistance;\n\nvoid main() {\n\n  // #include <uv_vertex>\n  #if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE )\n    vUv = vec2( mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t );\n  #endif\n\n  #include <uv2_vertex>\n  #include <color_vertex>\n\n  #include <beginnormal_vertex>\n  #include <morphnormal_vertex>\n  #include <skinbase_vertex>\n  #include <skinnormal_vertex>\n  #include <defaultnormal_vertex>\n\n  #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n  #endif\n\n  #include <begin_vertex>\n\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  // #include <displacementmap_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n  #include <clipping_planes_vertex>\n\n  vViewPosition = - mvPosition.xyz;\n\n  float outlineTex = 1.0;\n\n  #ifdef OUTLINE\n    #ifdef USE_OUTLINEWIDTHTEXTURE\n      outlineTex = texture2D( outlineWidthTexture, vUv ).r;\n    #endif\n\n    #ifdef OUTLINE_WIDTH_WORLD\n      vec3 outlineOffset = 0.01 * outlineWidth * outlineTex * normalize( objectNormal );\n      gl_Position += projectionMatrix * modelViewMatrix * vec4( outlineOffset, 0.0 );\n    #endif\n\n    #ifdef OUTLINE_WIDTH_SCREEN\n      vec3 clipNormal = ( projectionMatrix * modelViewMatrix * vec4( normalize( objectNormal ), 0.0 ) ).xyz;\n      vec2 projectedNormal = normalize( clipNormal.xy );\n      projectedNormal *= min( gl_Position.w, outlineScaledMaxDistance );\n      projectedNormal.x *= projectionMatrix[ 0 ].x / projectionMatrix[ 1 ].y;\n      gl_Position.xy += 0.01 * outlineWidth * projectedNormal.xy;\n    #endif\n\n    gl_Position.z += 1E-6 * gl_Position.w; // anti-artifact magic\n  #endif\n\n  #include <worldpos_vertex>\n  // #include <envmap_vertex>\n  #include <shadowmap_vertex>\n  #include <fog_vertex>\n\n}"},function(e,t){e.exports="// #define PHONG\n\n#ifdef BLENDMODE_CUTOUT\n  uniform float cutoff;\n#endif\n\nuniform vec3 color;\nuniform float colorAlpha;\nuniform vec3 shadeColor;\n#ifdef USE_SHADETEXTURE\n  uniform sampler2D shadeTexture;\n#endif\n\nuniform float receiveShadowRate;\n#ifdef USE_RECEIVESHADOWTEXTURE\n  uniform sampler2D receiveShadowTexture;\n#endif\n\nuniform float shadingGradeRate;\n#ifdef USE_SHADINGGRADETEXTURE\n  uniform sampler2D shadingGradeTexture;\n#endif\n\nuniform float shadeShift;\nuniform float shadeToony;\nuniform float lightColorAttenuation;\nuniform float indirectLightIntensity;\n\n#ifdef USE_RIMTEXTURE\n  uniform sampler2D rimTexture;\n#endif\nuniform vec3 rimColor;\nuniform float rimLightingMix;\nuniform float rimFresnelPower;\nuniform float rimLift;\n\n#ifdef USE_SPHEREADD\n  uniform sampler2D sphereAdd;\n#endif\n\nuniform vec3 emissionColor;\n\nuniform vec3 outlineColor;\nuniform float outlineLightingMix;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n// #include <uv_pars_fragment>\n#if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE )\n  varying vec2 vUv;\n#endif\n\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n// #include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n// #include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n// #include <envmap_pars_fragment>\n// #include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n\n// #include <lights_phong_pars_fragment>\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n\n#define Material_LightProbeLOD( material ) (0)\n\n#include <shadowmap_pars_fragment>\n// #include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n  uniform sampler2D normalMap;\n  uniform float bumpScale;\n\n  // this number is very random, this is still a \n  #define UV_DERIVATIVE_EPSILON 1E-6\n\n  // Per-Pixel Tangent Space Normal Mapping\n  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n  vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n    vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n    vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n    vec2 st0 = dFdx( vUv.st );\n    vec2 st1 = dFdy( vUv.st );\n\n    float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n    vec3 S = ( q0 * st1.t - q1 * st0.t ) * scale;\n    vec3 T = ( - q0 * st1.s + q1 * st0.s ) * scale;\n\n    // See: https://hub.vroid.com/characters/5207275812824687366/models/1630298405840303507\n    if ( length( S ) == 0.0 || length( T ) == 0.0 ) {\n      return surf_norm;\n    }\n\n    S = normalize( S );\n    T = normalize( T );\n\n    vec3 N = normalize( surf_norm );\n    mat3 tsn = mat3( S, T, N );\n    vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n    mapN.xy *= bumpScale;\n    mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n    return normalize( tsn * mapN );\n  }\n#endif\n\n// #include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// == lighting stuff ===========================================================\nfloat getLightIntensity(\n  const in IncidentLight directLight,\n  const in GeometricContext geometry,\n  const in float shadow,\n  const in float shadingGrade\n) {\n  float lightIntensity = dot( geometry.normal, directLight.direction );\n  lightIntensity = 0.5 + 0.5 * lightIntensity;\n  lightIntensity = lightIntensity * shadow;\n  lightIntensity = lightIntensity * shadingGrade;\n  lightIntensity = lightIntensity * 2.0 - 1.0;\n  return smoothstep( shadeShift, shadeShift + ( 1.0 - shadeToony ), lightIntensity );\n}\n\nvec3 getLighting( const in vec3 lightColor ) {\n  vec3 lighting = lightColor;\n  lighting = mix(\n    lighting,\n    vec3( max( 0.001, max( lighting.x, max( lighting.y, lighting.z ) ) ) ),\n    lightColorAttenuation\n  );\n\n  #ifndef PHYSICALLY_CORRECT_LIGHTS\n    lighting *= PI;\n  #endif\n\n  return lighting;\n}\n\nvec3 getDiffuse(\n  const in vec3 lit,\n  const in vec3 shade,\n  const in float lightIntensity,\n  const in vec3 lighting\n) {\n  #ifdef DEBUG_LITSHADERATE\n    return vec3( BRDF_Diffuse_Lambert( lightIntensity * lighting ) );\n  #endif\n\n  return lighting * BRDF_Diffuse_Lambert( mix( shade, lit, lightIntensity ) );\n}\n\nvec3 calcDirectDiffuse(\n  const in vec3 lit,\n  const in vec3 shade,\n  in GeometricContext geometry,\n  inout ReflectedLight reflectedLight\n) {\n  IncidentLight directLight;\n  vec3 lightingSum = vec3( 0.0 );\n\n  float shadingGrade = 1.0;\n  #ifdef USE_SHADINGGRADETEXTURE\n    shadingGrade = 1.0 - shadingGradeRate * ( 1.0 - texture2D( shadingGradeTexture, vUv ).r );\n  #endif\n\n  float receiveShadow = receiveShadowRate;\n  #ifdef USE_RECEIVESHADOWTEXTURE\n    receiveShadow *= texture2D( receiveShadowTexture, vUv ).a;\n  #endif\n\n  #if ( NUM_POINT_LIGHTS > 0 )\n    PointLight pointLight;\n\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n      pointLight = pointLights[ i ];\n      getPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n      float atten = 1.0;\n      #ifdef USE_SHADOWMAP\n        atten = all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n      #endif\n\n      float shadow = 1.0 - receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );\n      float lightIntensity = getLightIntensity( directLight, geometry, shadow, shadingGrade );\n      vec3 lighting = getLighting( directLight.color );\n      reflectedLight.directDiffuse += getDiffuse( lit, shade, lightIntensity, lighting );\n      lightingSum += lighting;\n    }\n  #endif\n\n  #if ( NUM_SPOT_LIGHTS > 0 )\n    SpotLight spotLight;\n\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n      spotLight = spotLights[ i ];\n      getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n      float atten = 1.0;\n      #ifdef USE_SHADOWMAP\n        atten = all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n      #endif\n\n      float shadow = 1.0 - receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );\n      float lightIntensity = getLightIntensity( directLight, geometry, shadow, shadingGrade );\n      vec3 lighting = getLighting( directLight.color );\n      reflectedLight.directDiffuse += getDiffuse( lit, shade, lightIntensity, lighting );\n      lightingSum += lighting;\n    }\n  #endif\n\n  #if ( NUM_DIR_LIGHTS > 0 )\n    DirectionalLight directionalLight;\n\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n      directionalLight = directionalLights[ i ];\n      getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n      float atten = 1.0;\n      #ifdef USE_SHADOWMAP\n        atten = all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n      #endif\n\n      float shadow = 1.0 - receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );\n      float lightIntensity = getLightIntensity( directLight, geometry, shadow, shadingGrade );\n      vec3 lighting = getLighting( directLight.color );\n      reflectedLight.directDiffuse += getDiffuse( lit, shade, lightIntensity, lighting );\n      lightingSum += lighting;\n    }\n  #endif\n\n  return lightingSum;\n}\n\n// == post correction ==========================================================\nvoid postCorrection() {\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n  #include <premultiplied_alpha_fragment>\n  #include <dithering_fragment>\n}\n\n// == main procedure ===========================================================\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  #ifdef DEBUG_UV\n    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n    #if defined( USE_MAP ) || defined( USE_SHADETEXTURE ) || defined( USE_NORMALMAP ) || defined( USE_RECEIVESHADOWTEXTURE ) || defined( USE_SHADINGGRADETEXTURE ) || defined( USE_RIMTEXTURE ) || defined( USE_EMISSIVEMAP ) || defined( USE_OUTLINEWIDTHTEXTURE )\n      gl_FragColor = vec4( vUv, 0.0, 1.0 );\n    #endif\n    return;\n  #endif\n\n  vec4 diffuseColor = vec4( color, colorAlpha );\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n  vec3 totalEmissiveRadiance = emissionColor;\n\n  #include <logdepthbuf_fragment>\n\n  // #include <map_fragment>\n  #ifdef USE_MAP\n    diffuseColor *= mapTexelToLinear( texture2D( map, vUv ) );\n  #endif\n\n  #include <color_fragment>\n  // #include <alphamap_fragment>\n\n  // -- MToon: alpha -----------------------------------------------------------\n  // #include <alphatest_fragment>\n  #ifdef BLENDMODE_CUTOUT\n    if ( diffuseColor.a <= cutoff ) { discard; }\n    diffuseColor.a = 1.0;\n  #endif\n\n  #ifdef BLENDMODE_OPAQUE\n    diffuseColor.a = 1.0;\n  #endif\n\n  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_FIXED ) // omitting DebugMode\n    gl_FragColor = vec4( outlineColor, diffuseColor.a );\n    postCorrection();\n    return;\n  #endif\n\n  // #include <specularmap_fragment>\n  #include <normal_fragment_begin>\n\n  #ifdef OUTLINE\n    normal *= -1.0;\n  #endif\n\n  #include <normal_fragment_maps>\n\n  // #include <emissivemap_fragment>\n  #ifdef USE_EMISSIVEMAP\n    totalEmissiveRadiance *= emissiveMapTexelToLinear( texture2D( emissiveMap, vUv ) ).rgb;\n  #endif\n\n  if (normal.z < 0.0) { // TODO: temporary treatment against Snapdragon issue\n    normal = -normal;\n  }\n\n  #ifdef DEBUG_NORMAL\n    gl_FragColor = vec4( 0.5 + 0.5 * normal, 1.0 );\n    return;\n  #endif\n\n  // -- MToon: lighting --------------------------------------------------------\n  // accumulation\n  // #include <lights_phong_fragment>\n  // #include <lights_fragment_begin>\n  vec3 lit = diffuseColor.rgb;\n  vec3 shade = shadeColor;\n  #ifdef USE_SHADETEXTURE\n    shade *= shadeTextureTexelToLinear( texture2D( shadeTexture, vUv ) ).rgb;\n  #endif\n\n  GeometricContext geometry;\n\n  geometry.position = - vViewPosition;\n  geometry.normal = normal;\n  geometry.viewDir = normalize( vViewPosition );\n\n  vec3 lighting = calcDirectDiffuse( diffuseColor.rgb, shade, geometry, reflectedLight );\n\n  vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n  #if ( NUM_HEMI_LIGHTS > 0 )\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n      irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n    }\n  #endif\n\n  // #include <lights_fragment_maps>\n  #ifdef USE_LIGHTMAP\n    vec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).rgb * lightMapIntensity;\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n      lightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n    #endif\n    irradiance += lightMapIrradiance;\n  #endif\n\n  // #include <lights_fragment_end>\n  reflectedLight.indirectDiffuse += indirectLightIntensity * irradiance * BRDF_Diffuse_Lambert( lit );\n\n  // modulation\n  #include <aomap_fragment>\n\n  vec3 col = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\n  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_MIXED ) // omitting DebugMode\n    gl_FragColor = vec4(\n      outlineColor.rgb * mix( vec3( 1.0 ), col, outlineLightingMix ),\n      diffuseColor.a\n    );\n    postCorrection();\n    return;\n  #endif\n\n  // -- MToon: parametric rim lighting -----------------------------------------\n  vec3 viewDir = normalize( vViewPosition );\n  vec3 rimMix = mix(vec3(1.0), lighting + indirectLightIntensity * irradiance, rimLightingMix);\n  vec3 rim = rimColor * pow( saturate( 1.0 - dot( viewDir, normal ) + rimLift ), rimFresnelPower );\n  #ifdef USE_RIMTEXTURE\n    rim *= texture2D( rimTexture, vUv ).rgb;\n  #endif\n  col += rim;\n\n  // -- MToon: additive matcap -------------------------------------------------\n  #ifdef USE_SPHEREADD\n    {\n      vec3 x = normalize( vec3( viewDir.z, 0.0, -viewDir.x ) );\n      vec3 y = cross( viewDir, x ); // guaranteed to be normalized\n      vec2 uv = 0.5 + 0.5 * vec2( dot( x, normal ), -dot( y, normal ) );\n      vec3 matcap = sphereAddTexelToLinear( texture2D( sphereAdd, uv ) ).xyz;\n      col += matcap;\n    }\n  #endif\n\n  // -- MToon: Emission --------------------------------------------------------\n  col += totalEmissiveRadiance;\n\n  // #include <envmap_fragment>\n\n  // -- Almost done! -----------------------------------------------------------\n  gl_FragColor = vec4( col, diffuseColor.a );\n  postCorrection();\n}"},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(0),s=function(e){function t(t){var n=e.call(this)||this;return n.isVRMUnlit=!0,n.cutoff=.5,n.map=null,n.mainTex_ST=new a.Vector4(0,0,1,1),n._renderType=o.Opaque,n.shouldApplyUniforms=!0,void 0===t&&(t={}),t.fog=!0,t.clipping=!0,t.skinning=t.skinning||!1,t.morphTargets=t.morphTargets||!1,t.morphNormals=t.morphNormals||!1,t.uniforms=a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,{cutoff:{value:.5},mainTex_ST:{value:new a.Vector4(0,0,1,1)}}]),n.setValues(t),n.updateShaderCode(),n}return r(t,e),Object.defineProperty(t.prototype,"mainTex",{get:function(){return this.map},set:function(e){this.map=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderType",{get:function(){return this._renderType},set:function(e){this._renderType=e,this.depthWrite=this._renderType!==o.Transparent,this.transparent=this._renderType===o.Transparent||this._renderType===o.TransparentWithZWrite,this.updateShaderCode()},enumerable:!0,configurable:!0}),t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.cutoff=t.cutoff,this.map=t.map,this.mainTex_ST.copy(t.mainTex_ST),this.renderType=t.renderType,this},t.prototype.applyUniforms=function(){this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST))},t.prototype.updateShaderCode=function(){this.defines={RENDERTYPE_OPAQUE:this._renderType===o.Opaque,RENDERTYPE_CUTOUT:this._renderType===o.Cutout,RENDERTYPE_TRANSPARENT:this._renderType===o.Transparent||this._renderType===o.TransparentWithZWrite},this.vertexShader=n(26),this.fragmentShader=n(27),this.needsUpdate=!0},t}(a.ShaderMaterial);t.Unlit=s,function(e){e[e.Opaque=0]="Opaque",e[e.Cutout=1]="Cutout",e[e.Transparent=2]="Transparent",e[e.TransparentWithZWrite=3]="TransparentWithZWrite"}(o=t.UnlitRenderType||(t.UnlitRenderType={}))},function(e,t){e.exports="#include <common>\n\n// #include <uv_pars_vertex>\n#ifdef USE_MAP\n  varying vec2 vUv;\n  uniform vec4 mainTex_ST;\n#endif\n\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n  // #include <uv_vertex>\n  #ifdef USE_MAP\n    vUv = vec2( mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t );\n  #endif\n\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n\n  #ifdef USE_ENVMAP\n\n  #include <beginnormal_vertex>\n  #include <morphnormal_vertex>\n  #include <skinnormal_vertex>\n  #include <defaultnormal_vertex>\n\n  #endif\n\n  #include <begin_vertex>\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <envmap_vertex>\n  #include <fog_vertex>\n\n}"},function(e,t){e.exports="#ifdef RENDERTYPE_CUTOUT\n  uniform float cutoff;\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n// #include <alphamap_pars_fragment>\n// #include <aomap_pars_fragment>\n// #include <lightmap_pars_fragment>\n// #include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n// #include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// == main procedure ===========================================================\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec4 diffuseColor = vec4( 1.0 );\n\n  #include <logdepthbuf_fragment>\n\n  // #include <map_fragment>\n  #ifdef USE_MAP\n    diffuseColor *= mapTexelToLinear( texture2D( map, vUv ) );\n  #endif\n\n  #include <color_fragment>\n  // #include <alphamap_fragment>\n\n  // MToon: alpha\n  // #include <alphatest_fragment>\n  #ifdef RENDERTYPE_CUTOUT\n    if ( diffuseColor.a <= cutoff ) { discard; }\n    diffuseColor.a = 1.0;\n  #endif\n\n  #ifdef RENDERTYPE_OPAQUE\n    diffuseColor.a = 1.0;\n  #endif\n\n  // #include <specularmap_fragment>\n\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n  // accumulation (baked indirect lighting only)\n  #ifdef USE_LIGHTMAP\n    reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n  #else\n    reflectedLight.indirectDiffuse += vec3( 1.0 );\n  #endif\n\n  // modulation\n  // #include <aomap_fragment>\n\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n  vec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n  // #include <envmap_fragment>\n\n  gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}"},function(e,t,n){"use strict";function i(e){e.geometry&&(e.geometry.dispose(),e.geometry=void 0),e.material&&Array.isArray(e.material)?e.material.forEach(function(e){return r(e)}):e.material&&r(e.material)}function r(e){Object.keys(e).forEach(function(t){e[t]&&"function"==typeof e[t].dispose&&e[t].dispose()}),e.dispose(),e=void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.deepDispose=function(e){e.traverse(i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e,t,n){this.expressions={},this._blendShapeMaster=e,this._blendShapePresetMap=t,this.expressions=n}return e.create=function(t,n,r){var o={};return Object.keys(n.blendShapeGroups).forEach(function(e){var r=[],a=n.blendShapeGroups[e].name+".weight",s=new i.NumberKeyframeTrack(a,[0,1],[1,1]);r.push(s);var l=new i.AnimationClip(e,1,r),u=t.clipAction(l);u.setEffectiveWeight(1).stop(),u.clampWhenFinished=!0,o[e]=u}),new e(n,r,o)},e.clamp=function(e){return Math.max(Math.min(e,1),0)},e.prototype.getExpression=function(e){return this.expressions[e]},e.prototype.getValue=function(e){var t=this.getController(e);return t&&t.weight},e.prototype.setValue=function(t,n){var i=this.getController(t);i&&(i.weight=e.clamp(n))},e.prototype.update=function(){this._blendShapeMaster.update()},e.prototype.getController=function(e){var t=this._blendShapePresetMap[e],n=this._blendShapeMaster.getBlendShapeGroup(t||e);if(n)return n;console.warn("no blend shape found by "+e)},e}();t.VRMBlendShapeProxy=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(0);!function(e){e[e.NUMBER=0]="NUMBER",e[e.VECTOR2=1]="VECTOR2",e[e.VECTOR3=2]="VECTOR3",e[e.VECTOR4=3]="VECTOR4",e[e.COLOR=4]="COLOR"}(o||(o={}));var s=new a.Vector2,l=new a.Vector3,u=new a.Vector4,c=new a.Color,d=function(e){function t(t){var n=e.call(this)||this;return n.weight=0,n.isBinary=!1,n._binds=[],n._materialValues=[],n.name="BlendShapeController_"+t,n.type="BlendShapeController",n.visible=!1,n}return r(t,e),t.prototype.addBind=function(e){var t=e.weight/100;this._binds.push({meshes:e.meshes,morphTargetIndex:e.morphTargetIndex,weight:t})},t.prototype.addMaterialValue=function(e){var t,n,i,r,s=e.material,l=e.propertyName,u=s[l];u&&((u=e.defaultValue||u).isVector2?(t=o.VECTOR2,n=u.clone(),r=(i=(new a.Vector2).fromArray(e.targetValue)).clone().sub(n)):u.isVector3?(t=o.VECTOR3,n=u.clone(),r=(i=(new a.Vector3).fromArray(e.targetValue)).clone().sub(n)):u.isVector4?(t=o.VECTOR4,n=u.clone(),r=(i=(new a.Vector4).fromArray([e.targetValue[2],e.targetValue[3],e.targetValue[0],e.targetValue[1]])).clone().sub(n)):u.isColor?(t=o.COLOR,n=u.clone(),r=(i=(new a.Color).fromArray(e.targetValue)).clone().sub(n)):(t=o.NUMBER,n=u,r=(i=e.targetValue[0])-n),this._materialValues.push({material:s,propertyName:l,defaultValue:n,targetValue:i,deltaValue:r,type:t}))},t.prototype.applyWeight=function(){var e=this.isBinary?this.weight<.5?0:1:this.weight;this._binds.forEach(function(t){t.meshes.forEach(function(n){n.morphTargetInfluences&&(n.morphTargetInfluences[t.morphTargetIndex]+=e*t.weight)})}),this._materialValues.forEach(function(t){if(void 0!==t.material[t.propertyName]){if(t.type===o.NUMBER){var n=t.deltaValue;t.material[t.propertyName]+=n*e}else if(t.type===o.VECTOR2){n=t.deltaValue;t.material[t.propertyName].add(s.copy(n).multiplyScalar(e))}else if(t.type===o.VECTOR3){n=t.deltaValue;t.material[t.propertyName].add(l.copy(n).multiplyScalar(e))}else if(t.type===o.VECTOR4){n=t.deltaValue;t.material[t.propertyName].add(u.copy(n).multiplyScalar(e))}else if(t.type===o.COLOR){n=t.deltaValue;t.material[t.propertyName].add(c.copy(n).multiplyScalar(e))}"boolean"==typeof t.material.shouldApplyUniforms&&(t.material.shouldApplyUniforms=!0)}})},t.prototype.clearAppliedWeight=function(){this._binds.forEach(function(e){e.meshes.forEach(function(t){t.morphTargetInfluences&&(t.morphTargetInfluences[e.morphTargetIndex]=0)})}),this._materialValues.forEach(function(e){if(void 0!==e.material[e.propertyName]){if(e.type===o.NUMBER){var t=e.defaultValue;e.material[e.propertyName]=t}else if(e.type===o.VECTOR2){t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===o.VECTOR3){t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===o.VECTOR4){t=e.defaultValue;e.material[e.propertyName].copy(t)}else if(e.type===o.COLOR){t=e.defaultValue;e.material[e.propertyName].copy(t)}"boolean"==typeof e.material.shouldApplyUniforms&&(e.material.shouldApplyUniforms=!0)}})},t}(a.Object3D);t.BlendShapeController=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._blendShapeGroups={}}return Object.defineProperty(e.prototype,"blendShapeGroups",{get:function(){return this._blendShapeGroups},enumerable:!0,configurable:!0}),e.prototype.getBlendShapeGroup=function(e){return this._blendShapeGroups[e]},e.prototype.registerBlendShapeGroup=function(e,t){this._blendShapeGroups[e]=t},e.prototype.update=function(){var e=this;Object.keys(this._blendShapeGroups).forEach(function(t){e._blendShapeGroups[t].clearAppliedWeight()}),Object.keys(this._blendShapeGroups).forEach(function(t){e._blendShapeGroups[t].applyWeight()})},e}();t.BlendShapeMaster=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(0);!function(e){e[e.Auto=0]="Auto",e[e.Both=1]="Both",e[e.ThirdPersonOnly=2]="ThirdPersonOnly",e[e.FirstPersonOnly=3]="FirstPersonOnly"}(i||(i={}));var o=function(){function e(t,n){this.firstPersonFlag=e.parseFirstPersonFlag(t),this.mesh=n}return e.parseFirstPersonFlag=function(e){switch(e){case"Both":return i.Both;case"ThirdPersonOnly":return i.ThirdPersonOnly;case"FirstPersonOnly":return i.FirstPersonOnly;default:return i.Auto}},e}();t.RendererFirstPersonFlags=o;var a=function(){function e(t,n,i){this._meshAnnotations=[],this._firstPersonOnlyLayer=e.DEFAULT_FIRSTPERSON_ONLY_LAYER,this._thirdPersonOnlyLayer=e.DEFAULT_THIRDPERSON_ONLY_LAYER,this._initialized=!1,this._firstPersonBone=t,this._firstPersonBoneOffset=n,this._meshAnnotations=i}return e.prototype.getFirstPersonBone=function(){return this._firstPersonBone},e.prototype.getFirstPersonBoneOffset=function(){return this._firstPersonBoneOffset},e.prototype.getMeshAnnotations=function(){return this._meshAnnotations},e.prototype.setup=function(t){var n=this,r=void 0===t?{}:t,o=r.firstPersonOnlyLayer,a=void 0===o?e.DEFAULT_FIRSTPERSON_ONLY_LAYER:o,s=r.thirdPersonOnlyLayer,l=void 0===s?e.DEFAULT_THIRDPERSON_ONLY_LAYER:s;this._initialized||(this._initialized=!0,this._firstPersonOnlyLayer=a,this._thirdPersonOnlyLayer=l,this._meshAnnotations.forEach(function(e){e.firstPersonFlag===i.FirstPersonOnly?(e.mesh.layers.set(n._firstPersonOnlyLayer),e.mesh.traverse(function(e){return e.layers.set(n._firstPersonOnlyLayer)})):e.firstPersonFlag===i.ThirdPersonOnly?(e.mesh.layers.set(n._thirdPersonOnlyLayer),e.mesh.traverse(function(e){return e.layers.set(n._thirdPersonOnlyLayer)})):e.firstPersonFlag===i.Auto&&n.createHeadlessModel(e.mesh)}))},e.prototype.getFirstPersonOnlyLayer=function(){return this._firstPersonOnlyLayer},e.prototype.getThirdPersonOnlyLayer=function(){return this._thirdPersonOnlyLayer},e.prototype.getFirstPersonWorldPosition=function(e){var t=this._firstPersonBoneOffset,n=new r.Vector4(t.x,t.y,t.z,1);return n.applyMatrix4(this._firstPersonBone.matrixWorld),e.set(n.x,n.y,n.z)},e.prototype.excludeTriangles=function(e,t,n,i){var r=0;if(null!=t&&t.length>0)for(var o=0;o<e.length;o+=3){var a=e[o],s=e[o+1],l=e[o+2],u=t[a],c=n[a];if(!(u[0]>0&&i.includes(c[0]))&&!(u[1]>0&&i.includes(c[1])||u[2]>0&&i.includes(c[2])||u[3]>0&&i.includes(c[3]))){var d=t[s],h=n[s];if(!(d[0]>0&&i.includes(h[0])||d[1]>0&&i.includes(h[1])||d[2]>0&&i.includes(h[2])||d[3]>0&&i.includes(h[3]))){var p=t[l],f=n[l];p[0]>0&&i.includes(f[0])||p[1]>0&&i.includes(f[1])||p[2]>0&&i.includes(f[2])||p[3]>0&&i.includes(f[3])||(e[r++]=a,e[r++]=s,e[r++]=l)}}}return r},e.prototype.createErasedMesh=function(e,t){var n=new r.SkinnedMesh(e.geometry.clone(),e.material);n.name=e.name+"(erase)",n.frustumCulled=e.frustumCulled,n.layers.set(this._firstPersonOnlyLayer);for(var i=n.geometry,o=i.getAttribute("skinIndex").array,a=[],s=0;s<o.length;s+=4)a.push([o[s],o[s+1],o[s+2],o[s+3]]);var l=i.getAttribute("skinWeight").array,u=[];for(s=0;s<l.length;s+=4)u.push([l[s],l[s+1],l[s+2],l[s+3]]);var c=Array.from(i.getIndex().array),d=this.excludeTriangles(c,u,a,t),h=[];for(s=0;s<d;s++)h[s]=c[s];return i.setIndex(h),e.onBeforeRender&&(n.onBeforeRender=e.onBeforeRender),n.bind(new r.Skeleton(e.skeleton.bones,e.skeleton.boneInverses),new r.Matrix4),n},e.prototype.createHeadlessModelForSkinnedMesh=function(e,t){var n=this,i=[];if(t.skeleton.bones.forEach(function(e,t){n.isEraseTarget(e)&&i.push(t)}),!i.length)return t.layers.enable(this._thirdPersonOnlyLayer),void t.layers.enable(this._firstPersonOnlyLayer);t.layers.set(this._thirdPersonOnlyLayer);var r=this.createErasedMesh(t,i);e.add(r)},e.prototype.createHeadlessModel=function(e){var t=this;if("Group"===e.type)if(e.layers.set(this._thirdPersonOnlyLayer),this.isEraseTarget(e))e.traverse(function(e){return e.layers.set(t._thirdPersonOnlyLayer)});else{var n=new r.Group;n.name="_headless_"+e.name,n.layers.set(this._firstPersonOnlyLayer),e.parent.add(n),e.children.filter(function(e){return"SkinnedMesh"===e.type}).forEach(function(e){t.createHeadlessModelForSkinnedMesh(n,e)})}else"SkinnedMesh"===e.type?this.createHeadlessModelForSkinnedMesh(e.parent,e):this.isEraseTarget(e)&&(e.layers.set(this._thirdPersonOnlyLayer),e.traverse(function(e){return e.layers.set(t._thirdPersonOnlyLayer)}))},e.prototype.isEraseTarget=function(e){return e.name===this._firstPersonBone.name||!!e.parent&&this.isEraseTarget(e.parent)},e.DEFAULT_FIRSTPERSON_ONLY_LAYER=9,e.DEFAULT_THIRDPERSON_ONLY_LAYER=10,e}();t.VRMFirstPerson=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(4),o=new i.Vector3,a=new i.Vector3,s=new i.Euler,l=new i.Matrix4,u=new i.Quaternion,c=new i.Quaternion,d=new i.Quaternion,h=Object.freeze(new i.Vector3(0,1,0)),p=function(){function e(e,t){this.autoUpdate=!0,this.givingUpThreshold=void 0,this.dumpingFactor=.5,this._lastTargetPosition=new i.Vector3,this._applyer=t,this.head=e.head,this._leftEye=e.leftEye,this._rightEye=e.rightEye,this._leftEye&&(this.leftEyeWorldPosition=(new i.Vector3).setFromMatrixPosition(this._leftEye.matrixWorld)),this._rightEye&&(this.rightEyeWorldPosition=(new i.Vector3).setFromMatrixPosition(this._rightEye.matrixWorld))}return e.prototype.getApplyer=function(){return this._applyer},e.prototype.getTarget=function(){return this._target},e.prototype.setTarget=function(e){this._target=e,this._lookAtTarget=e.position.clone(),this._lastTargetPosition=e.position.clone(),this._lookAtTargetTo=e.position.clone()},e.prototype.getHeadPosition=function(){o.setFromMatrixPosition(this.head.matrixWorld);var e=o.x,t=o.z;return[e,this.leftEyeWorldPosition?this.leftEyeWorldPosition.y:this.rightEyeWorldPosition?this.rightEyeWorldPosition.y:o.y,t]},e.prototype.getFaceDirection=function(){l.extractRotation(this.head.matrixWorld);var e=o.set(0,0,-1);return e.applyMatrix4(l),[e.x,e.y,e.z]},e.prototype.lookAt=function(e,t,n){if(this._applyer){var i=o.fromArray(this.getHeadPosition()),p=a.set(e,t,n);l.identity().lookAt(i,p,h);var f=u.setFromRotationMatrix(l),m=c.multiplyQuaternions(f,r.getWorldQuaternionLite(this.head.parent,d).inverse());s.setFromQuaternion(m,"ZXY"),this._applyer.lookAt(s)}},e.prototype.update=function(){if(this._target&&this.head&&this.autoUpdate&&this._lookAtTarget&&this._lookAtTargetTo){this.setCurrentTargetPosition(this._target,this._lookAtTargetTo);var e=(new i.Vector3).set(this._lookAtTargetTo.x-this._lookAtTarget.x,this._lookAtTargetTo.y-this._lookAtTarget.y,this._lookAtTargetTo.z-this._lookAtTarget.z);this._lookAtTarget.add(e.multiplyScalar(this.dumpingFactor)),this.lookAt(this._lookAtTarget.x,this._lookAtTarget.y,this._lookAtTarget.z)}this._leftEye&&(this.leftEyeWorldPosition=(new i.Vector3).setFromMatrixPosition(this._leftEye.matrixWorld)),this._rightEye&&(this.rightEyeWorldPosition=(new i.Vector3).setFromMatrixPosition(this._rightEye.matrixWorld))},e.prototype.setCurrentTargetPosition=function(e,t){if(!this._lastTargetPosition.equals(e.position)){this.setTarget(e);var n=(new i.Vector3).fromArray(this.getHeadPosition()),r=(new i.Vector3).fromArray(this.getFaceDirection()),o=new i.Vector3(e.position.x,e.position.y,e.position.z),a=o.sub(n).normalize();if(void 0!==this.givingUpThreshold&&a.dot(r)<this.givingUpThreshold)return o.copy(n).add(r.multiplyScalar(3)),void t.copy(o);var s=o.distanceTo(n),l=a.multiplyScalar(s).add(n);t.set(l.x,l.y,l.z)}},e}();t.VRMLookAtHead=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(12),s=function(e){function t(t,n,i,r){var o=e.call(this,n,i,r)||this;return o._blendShapeProxy=t,o}return r(t,e),t.prototype.name=function(){return o.LookAtTypeName.BlendShape},t.prototype.lookAt=function(e){var t=e.x,n=e.y,i=a.CurveMapper.apply(l(this.lookAtHorizontalOuter)),r=a.CurveMapper.apply(l(this.lookAtVerticalDown)),s=a.CurveMapper.apply(l(this.lookAtVerticalUp));n<0?(this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookleft,0),this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookright,i.map(-n))):(this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookright,0),this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookleft,i.map(n))),t<0?(this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookdown,0),this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookup,s.map(-t))):(this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookup,0),this._blendShapeProxy.setValue(o.BlendShapePresetName.Lookdown,r.map(t)))},t}(n(5).VRMLookAtApplyer);function l(e){return{xRange:"number"==typeof e.xRange?a.DEG2RAD*e.xRange:void 0,yRange:e.yRange,curve:e.curve}}t.VRMLookAtBlendShapeApplyer=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(12),s=function(e){function t(t,n,i,r,o){var a=e.call(this,i,r,o)||this;return a._leftEye=t.leftEye,a._rightEye=t.rightEye,a.lookAtHorizontalInner=n,a}return r(t,e),t.prototype.name=function(){return o.LookAtTypeName.Bone},t.prototype.lookAt=function(e){var t=e.x,n=e.y,i=a.CurveMapper.apply(l(this.lookAtHorizontalInner)),r=a.CurveMapper.apply(l(this.lookAtHorizontalOuter)),o=a.CurveMapper.apply(l(this.lookAtVerticalDown)),s=a.CurveMapper.apply(l(this.lookAtVerticalUp));this._leftEye&&(this._leftEye.rotation.x=t<0?-o.map(-t):s.map(t),this._leftEye.rotation.y=n<0?-i.map(-n):r.map(n)),this._rightEye&&(this._rightEye.rotation.x=t<0?-o.map(-t):s.map(t),this._rightEye.rotation.y=n<0?-r.map(-n):i.map(n))},t}(n(5).VRMLookAtApplyer);function l(e){return{xRange:"number"==typeof e.xRange?a.DEG2RAD*e.xRange:void 0,yRange:"number"==typeof e.yRange?a.DEG2RAD*e.yRange:void 0,curve:e.curve}}t.VRMLookAtBoneApplyer=s},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(13),s=function(){function e(){this.springBoneGroupList=[]}return e.prototype.loadGLTF=function(e){return i(this,void 0,void 0,function(){var t,n,a=this;return r(this,function(s){switch(s.label){case 0:return void 0===(t=e.parser.json.extensions&&e.parser.json.extensions.VRM&&e.parser.json.extensions.VRM.secondaryAnimation&&e.parser.json.extensions.VRM.secondaryAnimation.boneGroups)?(console.warn("Could not find springBoneGroups in the VRM"),[2]):[4,this.getColliderMeshGroups(e)];case 1:return(n=s.sent()).forEach(function(t){var n;return(n=e.scene).add.apply(n,t.colliders)}),t.forEach(function(t){if(void 0!==t.stiffiness&&void 0!==t.gravityDir&&void 0!==t.gravityDir.x&&void 0!==t.gravityDir.y&&void 0!==t.gravityDir.z&&void 0!==t.gravityPower&&void 0!==t.dragForce&&void 0!==t.hitRadius&&void 0!==t.colliderGroups&&void 0!==t.bones){var s=t.stiffiness,l=new o.Vector3(t.gravityDir.x,t.gravityDir.y,t.gravityDir.z),u=t.gravityPower,c=t.dragForce,d=t.hitRadius,h=[];t.colliderGroups.forEach(function(e){h.push.apply(h,n[e].colliders)});var p=[];t.bones.forEach(function(t){return i(a,void 0,void 0,function(){var n,i=this;return r(this,function(r){switch(r.label){case 0:return[4,e.parser.getDependency("node",t)];case 1:return(n=r.sent())?(n.traverse(function(t){var n=i.createSpringBone(e,t,d,s,l,u,c,h);p.push(n)}),[2]):[2]}})})}),a.springBoneGroupList.push(p)}}),[2]}})})},e.prototype.lateUpdate=function(e){this.springBoneGroupList.forEach(function(t){t.forEach(function(t){t.update(e)})})},e.prototype.reset=function(){this.springBoneGroupList.forEach(function(e){e.forEach(function(e){e.reset()})})},e.prototype.isColiderMeshVisible=function(){return!1},e.prototype.createSpringBone=function(e,t,n,i,r,o,s,l){return void 0===l&&(l=[]),new a.VRMSpringBone(t,n,i,r,o,s,l)},e.prototype.getColliderMeshGroups=function(e){return i(this,void 0,void 0,function(){var t,n,s,l,u=this;return r(this,function(c){return void 0===(t=e.parser.json.extensions&&e.parser.json.extensions.VRM)?[2,[]]:void 0===(n=t.secondaryAnimation)?[2,[]]:void 0===(s=n.colliderGroups)?[2,[]]:(l=[],s.forEach(function(t){return i(u,void 0,void 0,function(){var n,i,s,u=this;return r(this,function(r){switch(r.label){case 0:return void 0===t.node||void 0===t.colliders?[2]:[4,e.parser.getDependency("node",t.node)];case 1:return n=r.sent(),i=[],t.colliders.forEach(function(e){if(void 0!==e.offset&&void 0!==e.offset.x&&void 0!==e.offset.y&&void 0!==e.offset.z&&void 0!==e.radius){var t=(new o.Matrix4).makeTranslation(e.offset.x,e.offset.y,-e.offset.z),r=u.isColiderMeshVisible(),s=new o.Mesh(new o.SphereBufferGeometry(e.radius,8,4),new o.MeshBasicMaterial({color:16711935,visible:r,wireframe:!0,transparent:!0,depthTest:!1}));s.material.renderOrder=a.GIZMO_RENDER_ORDER,s.name="vrmColliderSphere",s.geometry.computeBoundingSphere(),s.updateMatrixWorld=function(){s.matrixWorld.copy(n.matrixWorld).multiply(t)},i.push(s)}}),s={node:t.node,colliders:i},l.push(s),[2]}})})}),[2,l])})})},e}();t.VRMSpringBoneManager=s},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(14)),i(n(38)),i(n(15)),i(n(16))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),l=n(4),u=n(6),c=n(14),d=new s.Vector3,h=new s.Quaternion,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.option=function(e){return this._option=e,this},t.prototype.build=function(e){return o(this,void 0,void 0,function(){var t,n,i;return a(this,function(r){switch(r.label){case 0:return t=new c.VRMPartsBuilderDebugProxy(this._partsBuilder,this._option),n=new f(t,this._option),[4,this._materialConverter.convertGLTFMaterials(e)];case 1:return i=r.sent(),[4,n.loadGLTF(i)];case 2:return r.sent(),[2,n]}})})},t}(u.VRMBuilder);t.VRMBuilderDebug=p;var f=function(e){function t(t,n){var i=e.call(this,t)||this;return i._debugOption=n||{},i}return r(t,e),Object.defineProperty(t,"Builder",{get:function(){return new p},enumerable:!0,configurable:!0}),t.from=function(e){return(new p).build(e)},t.prototype.loadGLTF=function(t){return o(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return[4,e.prototype.loadGLTF.call(this,t)];case 1:return n.sent(),this._debugOption.disableBoxHelper||t.scene.add(new s.BoxHelper(t.scene)),this._debugOption.disableSkeletonHelper||t.scene.add(new s.SkeletonHelper(t.scene)),this._debugOption.disableFaceDirectionHelper||(this._faceDirectionHelper=new s.ArrowHelper(new s.Vector3(0,0,-1),new s.Vector3(0,0,0),.5,16711935),t.scene.add(this._faceDirectionHelper)),this.humanBones&&this.humanBones.leftEye&&this.lookAt&&!this._debugOption.disableLeftEyeDirectionHelper&&(this._leftEyeDirectionHelper=new s.ArrowHelper(new s.Vector3(0,0,-1),new s.Vector3(0,0,0),.3,16711935,.05),t.scene.add(this._leftEyeDirectionHelper)),this.humanBones&&this.humanBones.rightEye&&this.lookAt&&!this._debugOption.disableRightEyeDirectionHelper&&(this._rightEyeDirectionHelper=new s.ArrowHelper(new s.Vector3(0,0,-1),new s.Vector3(0,0,0),.3,16711935,.05),t.scene.add(this._rightEyeDirectionHelper)),[2]}})})},t.prototype.update=function(t){e.prototype.update.call(this,t),this.updateGizmos()},t.prototype.updateGizmos=function(){if(this.lookAt&&this._faceDirectionHelper&&(this._faceDirectionHelper.position.fromArray(this.lookAt.getHeadPosition()),this._faceDirectionHelper.setDirection(d.fromArray(this.lookAt.getFaceDirection()))),this.humanBones&&this.humanBones.leftEye&&this.lookAt&&this.lookAt.leftEyeWorldPosition&&this._leftEyeDirectionHelper){var e=l.getWorldQuaternionLite(this.humanBones.leftEye,h),t=d.set(0,0,-1).applyQuaternion(e);this._leftEyeDirectionHelper.position.copy(this.lookAt.leftEyeWorldPosition),this._leftEyeDirectionHelper.setDirection(t)}if(this.humanBones&&this.humanBones.rightEye&&this.lookAt&&this.lookAt.rightEyeWorldPosition&&this._rightEyeDirectionHelper){var n=l.getWorldQuaternionLite(this.humanBones.rightEye,h);t=d.set(0,0,-1).applyQuaternion(n);this._rightEyeDirectionHelper.position.copy(this.lookAt.rightEyeWorldPosition),this._rightEyeDirectionHelper.setDirection(t)}},t}(u.VRM);t.VRMDebug=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(40))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){return function(){}}();i.HumanBone.Hips,i.HumanBone.LeftUpperLeg,i.HumanBone.RightUpperLeg,i.HumanBone.LeftLowerLeg,i.HumanBone.RightLowerLeg,i.HumanBone.LeftFoot,i.HumanBone.RightFoot,i.HumanBone.Spine,i.HumanBone.Chest,i.HumanBone.Neck,i.HumanBone.Head,i.HumanBone.LeftShoulder,i.HumanBone.RightShoulder,i.HumanBone.LeftUpperArm,i.HumanBone.RightUpperArm,i.HumanBone.LeftLowerArm,i.HumanBone.RightLowerArm,i.HumanBone.LeftHand,i.HumanBone.RightHand,i.HumanBone.LeftToes,i.HumanBone.RightToes,i.HumanBone.LeftEye,i.HumanBone.RightEye,i.HumanBone.Jaw,i.HumanBone.LeftThumbProximal,i.HumanBone.LeftThumbIntermediate,i.HumanBone.LeftThumbDistal,i.HumanBone.LeftIndexProximal,i.HumanBone.LeftIndexIntermediate,i.HumanBone.LeftIndexDistal,i.HumanBone.LeftMiddleProximal,i.HumanBone.LeftMiddleIntermediate,i.HumanBone.LeftMiddleDistal,i.HumanBone.LeftRingProximal,i.HumanBone.LeftRingIntermediate,i.HumanBone.LeftRingDistal,i.HumanBone.LeftLittleProximal,i.HumanBone.LeftLittleIntermediate,i.HumanBone.LeftLittleDistal,i.HumanBone.RightThumbProximal,i.HumanBone.RightThumbIntermediate,i.HumanBone.RightThumbDistal,i.HumanBone.RightIndexProximal,i.HumanBone.RightIndexIntermediate,i.HumanBone.RightIndexDistal,i.HumanBone.RightMiddleProximal,i.HumanBone.RightMiddleIntermediate,i.HumanBone.RightMiddleDistal,i.HumanBone.RightRingProximal,i.HumanBone.RightRingIntermediate,i.HumanBone.RightRingDistal,i.HumanBone.RightLittleProximal,i.HumanBone.RightLittleIntermediate,i.HumanBone.RightLittleDistal,i.HumanBone.UpperChest,t.VRMHumanBones=r}]);